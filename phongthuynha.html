<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phong Th·ªßy Nh√† ·ªû</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; color: #333; }
        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }
        .btn:hover { transform: translateY(-2px); }
        .results { display: none; }
        .results.show { display: block; }
        .result-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .result-card h2 { color: #667eea; margin-bottom: 15px; font-size: 1.8em; }
        .result-card h3 { color: #764ba2; margin-top: 20px; margin-bottom: 10px; font-size: 1.3em; }
        .result-card h4 { color: #555; margin-top: 15px; margin-bottom: 8px; font-size: 1.1em; }
        .info-box {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .detail-box {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .highlight { background: #fff3cd; padding: 3px 8px; border-radius: 4px; font-weight: 600; }
        .element-tag {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
        }
        .kim { background: #ffd700; color: #333; }
        .moc { background: #228B22; color: white; }
        .thuy { background: #1E90FF; color: white; }
        .hoa { background: #FF4500; color: white; }
        .tho { background: #8B4513; color: white; }
        .direction-note {
            font-size: 0.95em;
            color: #666;
            font-style: italic;
            margin-top: 8px;
        }
        .compass-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        .quai-label {
            font-size: 14px;
            font-weight: bold;
            fill: #333;
        }
        /* CSS cho la b√†n ƒëi·ªán t·ª≠ t√≠ch h·ª£p */
        .compass-live-widget {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .compass-live-widget h4 {
            color: white;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2em;
        }
        
        .compass-live-display {
            background: white;
            border-radius: 12px;
            padding: 20px;
        }
        
        .compass-container-live {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .compass-device {
            position: relative;
            width: 220px;
            height: 220px;
            flex-shrink: 0;
        }
        
        .compass-device-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15), inset 0 2px 8px rgba(255, 255, 255, 0.5);
            position: relative;
            transition: transform 0.3s ease-out;
        }
        
        .compass-device-inner {
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            bottom: 12px;
            border-radius: 50%;
            background: white;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .compass-device-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            background: #667eea;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.5);
            z-index: 10;
        }
        
        .compass-device-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 80px;
            margin-left: -2px;
            margin-top: -70px;
            background: linear-gradient(to bottom, #e74c3c 0%, #e74c3c 50%, #95a5a6 50%, #95a5a6 100%);
            border-radius: 2px;
            transform-origin: 2px 70px;
            transition: transform 0.3s ease-out;
            z-index: 5;
        }
        
        .compass-device-needle::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-bottom: 14px solid #e74c3c;
        }
        
        .compass-device-labels {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .compass-device-label {
            position: absolute;
            font-weight: bold;
            color: #333;
        }
        
        .compass-device-label.n { 
            top: 12px; 
            left: 50%; 
            transform: translateX(-50%); 
            color: #e74c3c; 
            font-size: 18px; 
        }
        .compass-device-label.e { 
            top: 50%; 
            right: 12px; 
            transform: translateY(-50%); 
            font-size: 15px; 
        }
        .compass-device-label.s { 
            bottom: 12px; 
            left: 50%; 
            transform: translateX(-50%); 
            font-size: 15px; 
        }
        .compass-device-label.w { 
            top: 50%; 
            left: 12px; 
            transform: translateY(-50%); 
            font-size: 15px; 
        }
        
        .compass-info-live {
            flex: 1;
            min-width: 250px;
        }
        
        .compass-degree-live {
            font-size: 56px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .compass-direction-live {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .compass-btn-live {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 0 auto 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .compass-btn-live:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .compass-btn-live:active {
            transform: translateY(0);
        }
        
        .compass-status-live {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
            padding: 8px;
            background: #f5f7fa;
            border-radius: 6px;
        }
        
        .compass-error-live {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            text-align: center;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .compass-use-direction-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 15px auto 0;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }
        
        .compass-use-direction-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .compass-use-direction-btn:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            /* Header */
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 14px;
            }
            
            /* Container padding */
            body {
                padding: 10px;
            }
            
            .container {
                padding: 0;
            }
            
            /* Card padding */
            .card {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            
            /* Input section */
            .input-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            /* Form elements */
            input, select {
                font-size: 16px; /* Quan tr·ªçng: tr√°nh zoom khi focus tr√™n iOS */
                padding: 14px 12px;
            }
            
            label {
                font-size: 15px;
            }
            
            /* Button */
            .btn {
                padding: 14px 30px;
                font-size: 16px;
            }
            
            /* Result cards */
            .result-card {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            
            .result-card h2 {
                font-size: 1.5em;
                margin-bottom: 12px;
            }
            
            .result-card h3 {
                font-size: 1.2em;
                margin-top: 15px;
                margin-bottom: 8px;
            }
            
            .result-card h4 {
                font-size: 1em;
                margin-top: 12px;
                margin-bottom: 8px;
            }
            
            /* Info boxes */
            .info-box {
                padding: 12px;
                font-size: 14px;
            }
            
            .detail-box {
                padding: 12px;
                font-size: 14px;
            }
            
            .detail-box ul {
                margin-left: 15px;
            }
            
            .detail-box ul li {
                font-size: 13px;
                margin-bottom: 5px;
            }
            
            /* Highlight text */
            .highlight {
                font-size: 13px;
                padding: 2px 6px;
            }
            
            /* Element tags */
            .element-tag {
                padding: 6px 15px;
                font-size: 14px;
                margin: 3px;
            }
            
            /* Direction note */
            .direction-note {
                font-size: 12px;
            }
            
            /* ========== LA B√ÄN ƒêI·ªÜN T·ª¨ - MOBILE ========== */
            
            /* La b√†n live widget */
            .compass-live-widget {
                padding: 15px;
                margin: 15px 0;
            }
            
            .compass-live-widget h4 {
                font-size: 1em;
                margin-bottom: 12px;
            }
            
            .compass-live-display {
                padding: 15px;
            }
            
            .compass-container-live {
                flex-direction: column;
                gap: 20px;
            }
            
            /* La b√†n device - nh·ªè h∆°n tr√™n mobile */
            .compass-device {
                width: 180px;
                height: 180px;
            }
            
            .compass-device-circle {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15), inset 0 2px 5px rgba(255, 255, 255, 0.5);
            }
            
            .compass-device-inner {
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
            }
            
            .compass-device-center {
                width: 15px;
                height: 15px;
            }
            
            .compass-device-needle {
                width: 3px;
                height: 65px;
                margin-left: -1.5px;
                margin-top: -55px;
                transform-origin: 1.5px 55px;
            }
            
            .compass-device-needle::before {
                border-left: 5px solid transparent;
                border-right: 5px solid transparent;
                border-bottom: 10px solid #e74c3c;
                top: -8px;
            }
            
            .compass-device-label.n {
                font-size: 16px;
                top: 8px;
            }
            
            .compass-device-label.e,
            .compass-device-label.s,
            .compass-device-label.w {
                font-size: 13px;
            }
            
            .compass-device-label.e {
                right: 8px;
            }
            
            .compass-device-label.s {
                bottom: 8px;
            }
            
            .compass-device-label.w {
                left: 8px;
            }
            
            /* Info live */
            .compass-info-live {
                min-width: 100%;
            }
            
            .compass-degree-live {
                font-size: 42px;
                margin-bottom: 8px;
            }
            
            .compass-direction-live {
                font-size: 18px;
                margin-bottom: 12px;
            }
            
            /* Buttons */
            .compass-btn-live {
                padding: 12px 25px;
                font-size: 15px;
                margin-bottom: 8px;
                width: 100%;
                max-width: 300px;
            }
            
            .compass-use-direction-btn {
                padding: 10px 20px;
                font-size: 14px;
                margin: 12px auto 0;
                width: 100%;
                max-width: 300px;
            }
            
            /* Status */
            .compass-status-live {
                font-size: 13px;
                padding: 8px 6px;
            }
            
            .compass-error-live {
                font-size: 12px;
                padding: 10px 8px;
            }
            
            /* ========== LA B√ÄN Tƒ®NH SVG - MOBILE ========== */
            
            .compass-section {
                gap: 15px;
                margin: 15px 0;
            }
            
            /* SVG compass scaling */
            .compass-section > div {
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .compass-section svg {
                width: 100% !important;
                height: auto !important;
                max-width: 400px;
                display: block;
                margin: 0 auto;
            }
            
            /* Qu·∫ª labels trong SVG */
            .quai-label {
                font-size: 12px;
            }
        }
        /* ========================================
           TH√äM RESPONSIVE CHO MOBILE NH·ªé H∆†N
           Th√™m ti·∫øp sau ph·∫ßn @media (max-width: 768px)
        ======================================== */
        
        @media (max-width: 480px) {
            /* Header nh·ªè h∆°n */
            .header h1 {
                font-size: 1.5em;
            }
            
            .header p {
                font-size: 13px;
            }
            
            /* Card padding nh·ªè h∆°n */
            .card {
                padding: 15px 10px;
                border-radius: 15px;
            }
            
            /* Result card */
            .result-card {
                padding: 15px 10px;
                border-radius: 12px;
            }
            
            .result-card h2 {
                font-size: 1.3em;
            }
            
            .result-card h3 {
                font-size: 1.1em;
            }
            
            .result-card h4 {
                font-size: 0.95em;
            }
            
            /* Info boxes */
            .info-box,
            .detail-box {
                padding: 10px;
                font-size: 13px;
            }
            
            .detail-box ul li {
                font-size: 12px;
            }
            
            /* La b√†n device - nh·ªè nh·∫•t */
            .compass-device {
                width: 160px;
                height: 160px;
            }
            
            .compass-device-needle {
                width: 2.5px;
                height: 55px;
                margin-left: -1.25px;
                margin-top: -48px;
                transform-origin: 1.25px 48px;
            }
            
            .compass-device-needle::before {
                border-left: 4px solid transparent;
                border-right: 4px solid transparent;
                border-bottom: 8px solid #e74c3c;
            }
            
            .compass-device-label.n {
                font-size: 14px;
            }
            
            .compass-device-label.e,
            .compass-device-label.s,
            .compass-device-label.w {
                font-size: 11px;
            }
            
            /* Degrees */
            .compass-degree-live {
                font-size: 36px;
            }
            
            .compass-direction-live {
                font-size: 16px;
            }
            
            /* Buttons nh·ªè h∆°n */
            .compass-btn-live {
                padding: 11px 20px;
                font-size: 14px;
            }
            
            .compass-use-direction-btn {
                padding: 9px 18px;
                font-size: 13px;
            }
            
            /* SVG compass */
            .compass-section svg {
                max-width: 320px;
            }
        }
        
        /* ========================================
           TH√äM: TOUCH-FRIENDLY IMPROVEMENTS
           C·∫£i thi·ªán tr·∫£i nghi·ªám touch tr√™n mobile
        ======================================== */
        
        @media (max-width: 768px) {
            /* TƒÉng k√≠ch th∆∞·ªõc v√πng ch·∫°m cho buttons */
            .btn,
            .compass-btn-live,
            .compass-use-direction-btn {
                min-height: 44px; /* iOS recommended touch target */
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
            
            /* Select v√† input d·ªÖ ch·∫°m h∆°n */
            input,
            select {
                min-height: 44px;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Smooth scrolling */
            html {
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Tr√°nh text selection khi double tap */
            .compass-device,
            .compass-info-live {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            
            /* SVG text d·ªÖ ƒë·ªçc h∆°n */
            svg text {
                pointer-events: none;
            }
        }
        
        /* ========================================
           LANDSCAPE MODE (Ch·∫ø ƒë·ªô ngang)
        ======================================== */
        
        @media (max-width: 768px) and (orientation: landscape) {
            .compass-container-live {
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
            
            .compass-device {
                width: 150px;
                height: 150px;
            }
            
            .compass-info-live {
                min-width: 200px;
            }
            
            .compass-degree-live {
                font-size: 36px;
            }
            
            .compass-direction-live {
                font-size: 16px;
            }
        }
        /* ========== LA B√ÄN T∆Ø∆†NG T√ÅC T√çCH H·ª¢P SVG ========== */
        .compass-svg-container {
            position: relative;
            width: 100%;
            max-width: 750px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #interactiveCompassSVG {
            transition: transform 0.3s ease-out;
        }
        
        /* Kim la b√†n ·∫©n m·∫∑c ƒë·ªãnh */
        #interactiveCompassNeedle {
            opacity: 0 !important;
        }
        
        #interactiveCompassNeedle.active {
            opacity: 1 !important;
        }
        
        /* Label ƒë·ªô tr√™n m≈©i t√™n */
        #compassDegreeLabel {
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #compassDegreeLabel.active {
            opacity: 1;
        }
        
        /* N√∫t ƒëi·ªÅu khi·ªÉn la b√†n */
        .compass-controls-bottom {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .compass-btn-control {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            min-width: 200px;
        }
        
        .compass-btn-activate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .compass-btn-activate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .compass-btn-activate.active {
            background: #4CAF50;
        }
        
        .compass-btn-apply {
            background: #4CAF50;
            color: white;
        }
        
        .compass-btn-apply:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .compass-btn-control:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            opacity: 0.6;
        }
        
        .compass-error-msg {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .compass-controls-bottom {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .compass-btn-control {
                width: 100%;
                max-width: 300px;
                min-width: unset;
                padding: 12px 25px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .compass-btn-control {
                padding: 11px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Phong Th·ªßy Nh√† ·ªû üè†</h1>
            <p>B·ªë tr√≠ nh√† c·ª≠a theo phong th·ªßy ƒê√¥ng ph∆∞∆°ng</p>
        </div>

        <div class="card">
            <div class="input-section">
                <div class="form-group">
                    <label for="year">NƒÉm sinh (D∆∞∆°ng l·ªãch):</label>
                    <input type="number" id="year" placeholder="NƒÉm sinh" min="1900" max="2100">
                </div>
                <div class="form-group">
                    <label for="gender">Gi·ªõi t√≠nh:</label>
                    <select id="gender">
                        <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
                        <option value="nam">Nam</option>
                        <option value="nu">N·ªØ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="doorDir">H∆∞·ªõng c·ª≠a ch√≠nh:</label>
                    <select id="doorDir">
                        <option value="">Ch·ªçn h∆∞·ªõng</option>
                        <option value="B·∫Øc">B·∫Øc</option>
                        <option value="ƒê√¥ng B·∫Øc">ƒê√¥ng B·∫Øc</option>
                        <option value="ƒê√¥ng">ƒê√¥ng</option>
                        <option value="ƒê√¥ng Nam">ƒê√¥ng Nam</option>
                        <option value="Nam">Nam</option>
                        <option value="T√¢y Nam">T√¢y Nam</option>
                        <option value="T√¢y">T√¢y</option>
                        <option value="T√¢y B·∫Øc">T√¢y B·∫Øc</option>
                    </select>
                </div>
            </div>
            <div id="error-message" style="color: #f44336; font-weight: bold; margin-top: 10px; display: none;"></div>
            <button class="btn" onclick="calculateFengShui()">Xem</button>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        const DATA = {
            menh: {
                'Kim': { colors: 'Tr·∫Øng, V√†ng, N√¢u, X√°m b·∫°c', items: 'ƒê·ªì kim lo·∫°i (ƒë·ªìng h·ªì, t∆∞·ª£ng ƒë·ªìng), chu√¥ng gi√≥ kim lo·∫°i, tranh n√∫i ƒë√°', plants: 'Kim ng√¢n, l∆∞·ª°i h·ªï, c√¢y l√° b·∫°c', stones: 'Th·∫°ch anh tr·∫Øng, kim sa, h·ªï ph√°ch tr·∫Øng', element: 'kim' },
                'M·ªôc': { colors: 'Xanh l√° c√¢y, Xanh lam, ƒêen, Xanh ng·ªçc', items: 'ƒê·ªì g·ªó t·ª± nhi√™n, tranh c√¢y c·ªëi, t∆∞·ª£ng g·ªó, bonsai', plants: 'C√¢y ph√°t t√†i, tr√∫c, ph√∫ qu√Ω, c√¢y xanh t∆∞∆°i t·ªët', stones: 'Ng·ªçc b√≠ch, m√£ n√£o xanh, emerald', element: 'moc' },
                'Th·ªßy': { colors: 'ƒêen, X√°m, Xanh d∆∞∆°ng ƒë·∫≠m, Xanh navy', items: 'B·ªÉ c√°, th√°c n∆∞·ªõc mini, tranh bi·ªÉn, ƒë√†i phun n∆∞·ªõc', plants: 'C√¢y th·ªßy sinh, sen ƒë√°, tr·∫ßu b√† n∆∞·ªõc, lan √Ω', stones: 'Th·∫°ch anh ƒëen, obsidian, lapis lazuli', element: 'thuy' },
                'H·ªèa': { colors: 'ƒê·ªè, Cam, H·ªìng, T√≠m, ƒê·ªè t∆∞∆°i', items: 'ƒê√®n trang tr√≠, n·∫øn th∆°m, tranh m·∫∑t tr·ªùi, ƒë·ªì ƒëi·ªán t·ª≠', plants: 'Hoa h·ªìng, ph∆∞·ª£ng, c√¢y l√° ƒë·ªè, hoa ƒë·ªè', stones: 'M√£ n√£o ƒë·ªè, h·ªìng ng·ªçc, garnet', element: 'hoa' },
                'Th·ªï': { colors: 'V√†ng, N√¢u ƒë·∫•t, Cam ƒë·∫•t, Be', items: 'ƒê·ªì g·ªëm s·ª©, ƒë√° t·ª± nhi√™n, t∆∞·ª£ng Ph·∫≠t ƒë·∫•t nung, l∆∞ h∆∞∆°ng', plants: 'X∆∞∆°ng r·ªìng, sen ƒë√°, c√¢y ƒëa, c√¢y l√° d√†y', stones: 'Th·∫°ch anh v√†ng, h·ªï ph√°ch, citrine', element: 'tho' }
            },
            quai: {
                'C√†n': { dirs: { good: ['T√¢y', 'ƒê√¥ng B·∫Øc', 'T√¢y Nam', 'T√¢y B·∫Øc'], bad: ['Nam', 'ƒê√¥ng', 'B·∫Øc', 'ƒê√¥ng Nam'] }, group: 'T√¢y T·ª© Tr·∫°ch', explain: 'Qu√°i C√†n t∆∞·ª£ng tr∆∞ng cho Tr·ªùi, kim lo·∫°i c·ª©ng r·∫Øn. Ng∆∞·ªùi m·ªánh C√†n th√≠ch s·ª± v·ªØng ch·∫Øc, tr·∫≠t t·ª±.' },
                'ƒêo√†i': { dirs: { good: ['T√¢y B·∫Øc', 'T√¢y Nam', 'ƒê√¥ng B·∫Øc', 'T√¢y'], bad: ['ƒê√¥ng', 'Nam', 'ƒê√¥ng Nam', 'B·∫Øc'] }, group: 'T√¢y T·ª© Tr·∫°ch', explain: 'Qu√°i ƒêo√†i t∆∞·ª£ng tr∆∞ng cho ƒê·∫ßm l·∫ßy, kim lo·∫°i m·ªÅm. Ng∆∞·ªùi m·ªánh ƒêo√†i vui v·∫ª, giao ti·∫øp t·ªët.' },
                'C·∫•n': { dirs: { good: ['T√¢y Nam', 'T√¢y B·∫Øc', 'T√¢y', 'ƒê√¥ng B·∫Øc'], bad: ['ƒê√¥ng Nam', 'B·∫Øc', 'ƒê√¥ng', 'Nam'] }, group: 'T√¢y T·ª© Tr·∫°ch', explain: 'Qu√°i C·∫•n t∆∞·ª£ng tr∆∞ng cho N√∫i, s·ª± v·ªØng ch·∫Øc. Ng∆∞·ªùi m·ªánh C·∫•n c√≥ t√≠nh b·ªÅn b·ªâ, ki√™n ƒë·ªãnh.' },
                'Kh√¥n': { dirs: { good: ['ƒê√¥ng B·∫Øc', 'T√¢y', 'T√¢y B·∫Øc', 'T√¢y Nam'], bad: ['B·∫Øc', 'ƒê√¥ng Nam', 'Nam', 'ƒê√¥ng'] }, group: 'T√¢y T·ª© Tr·∫°ch', explain: 'Qu√°i Kh√¥n t∆∞·ª£ng tr∆∞ng cho ƒê·∫•t, s·ª± bao dung. Ng∆∞·ªùi m·ªánh Kh√¥n c√≥ t√≠nh ki√™n nh·∫´n, nu√¥i d∆∞·ª°ng.' },
                'Ch·∫•n': { dirs: { good: ['Nam', 'B·∫Øc', 'ƒê√¥ng Nam', 'ƒê√¥ng'], bad: ['T√¢y', 'T√¢y B·∫Øc', 'ƒê√¥ng B·∫Øc', 'T√¢y Nam'] }, group: 'ƒê√¥ng T·ª© Tr·∫°ch', explain: 'Qu√°i Ch·∫•n t∆∞·ª£ng tr∆∞ng cho S·∫•m, s·ª± chuy·ªÉn ƒë·ªông. Ng∆∞·ªùi m·ªánh Ch·∫•n nƒÉng ƒë·ªông, quy·∫øt ƒëo√°n.' },
                'T·ªën': { dirs: { good: ['B·∫Øc', 'Nam', 'ƒê√¥ng', 'ƒê√¥ng Nam'], bad: ['ƒê√¥ng B·∫Øc', 'T√¢y Nam', 'T√¢y', 'T√¢y B·∫Øc'] }, group: 'ƒê√¥ng T·ª© Tr·∫°ch', explain: 'Qu√°i T·ªën t∆∞·ª£ng tr∆∞ng cho Gi√≥, s·ª± linh ho·∫°t. Ng∆∞·ªùi m·ªánh T·ªën kh√©o l√©o, th√≠ch nghi t·ªët.' },
                'Ly': { dirs: { good: ['ƒê√¥ng', 'ƒê√¥ng Nam', 'B·∫Øc', 'Nam'], bad: ['T√¢y B·∫Øc', 'T√¢y', 'T√¢y Nam', 'ƒê√¥ng B·∫Øc'] }, group: 'ƒê√¥ng T·ª© Tr·∫°ch', explain: 'Qu√°i Ly t∆∞·ª£ng tr∆∞ng cho L·ª≠a, √°nh s√°ng. Ng∆∞·ªùi m·ªánh Ly nhi·ªát huy·∫øt, s√°ng t·∫°o, n·ªïi b·∫≠t.' },
                'Kh·∫£m': { dirs: { good: ['ƒê√¥ng Nam', 'ƒê√¥ng', 'Nam', 'B·∫Øc'], bad: ['T√¢y Nam', 'ƒê√¥ng B·∫Øc', 'T√¢y B·∫Øc', 'T√¢y'] }, group: 'ƒê√¥ng T·ª© Tr·∫°ch', explain: 'Qu√°i Kh·∫£m t∆∞·ª£ng tr∆∞ng cho N∆∞·ªõc, s·ª± th·∫•u hi·ªÉu. Ng∆∞·ªùi m·ªánh Kh·∫£m th√¥ng minh, linh ho·∫°t.' }
            }
        };

        let preciseDoorDegree = null;
        const STARS = ['Sinh Kh√≠', 'Thi√™n Y', 'Di√™n Ni√™n', 'Ph·ª•c V·ªã'];
        const BAD_STARS = ['Tuy·ªát M·ªánh', 'Ng≈© Qu·ª∑', 'L·ª•c S√°t', 'H·ªça H·∫°i'];
        const STAR_DESC = ['C·ª±c t·ªët - V∆∞·ª£ng v·ªÅ t√†i l·ªôc, s·ª± nghi·ªáp, con c√°i kh·ªèe m·∫°nh th√¥ng minh', 'R·∫•t t·ªët - S·ª©c kh·ªèe d·ªìi d√†o, g·∫∑p qu√Ω nh√¢n ph√π tr·ª£, b·ªánh t·∫≠t ti√™u tan', 'T·ªët - H√¥n nh√¢n h·∫°nh ph√∫c, gia ƒë·∫°o h√≤a thu·∫≠n, s·ªëng l√¢u', 'Kh√° t·ªët - Cu·ªôc s·ªëng b√¨nh an, ·ªïn ƒë·ªãnh, kh√¥ng c√≥ bi·∫øn c·ªë l·ªõn'];
        const BAD_DESC = ['Hung nh·∫•t - Tai h·ªça l·ªõn, nguy hi·ªÉm t√≠nh m·∫°ng, ph√° s·∫£n', 'C·ª±c x·∫•u - B·ªánh t·∫≠t nghi√™m tr·ªçng, h·ªèa ho·∫°n, m·∫•t m√°t l·ªõn', 'R·∫•t x·∫•u - Tranh ch·∫•p ph√°p l√Ω, ki·ªán t·ª•ng, ti√™u t√°n t√†i s·∫£n', 'X·∫•u - D·ªÖ g·∫∑p tai n·∫°n nh·ªè, tranh c√£i trong gia ƒë√¨nh'];

        function calcMenh(y) {
            const napAm = [
                'Gi√°p T√Ω - H·∫£i Trung Kim','·∫§t S·ª≠u - H·∫£i Trung Kim','B√≠nh D·∫ßn - L∆∞ Trung H·ªèa','ƒêinh M√£o - L∆∞ Trung H·ªèa','M·∫≠u Th√¨n - ƒê·∫°i L√¢m M·ªôc','K·ª∑ T·ªµ - ƒê·∫°i L√¢m M·ªôc',
                'Canh Ng·ªç - L·ªô B√†ng Th·ªï','T√¢n M√πi - L·ªô B√†ng Th·ªï','Nh√¢m Th√¢n - Ki·∫øm Phong Kim','Qu√Ω D·∫≠u - Ki·∫øm Phong Kim','Gi√°p Tu·∫•t - S∆°n ƒê·∫ßu H·ªèa','·∫§t H·ª£i - S∆°n ƒê·∫ßu H·ªèa',
                'B√≠nh T√Ω - Gi·∫£n H·∫° Th·ªßy','ƒêinh S·ª≠u - Gi·∫£n H·∫° Th·ªßy','M·∫≠u D·∫ßn - Th√†nh ƒê·∫ßu Th·ªï','K·ª∑ M√£o - Th√†nh ƒê·∫ßu Th·ªï','Canh Th√¨n - B·∫°ch L·∫°p Kim','T√¢n T·ªµ - B·∫°ch L·∫°p Kim',
                'Nh√¢m Ng·ªç - D∆∞∆°ng Li·ªÖu M·ªôc','Qu√Ω M√πi - D∆∞∆°ng Li·ªÖu M·ªôc','Gi√°p Th√¢n - Tuy·ªÅn Trung Th·ªßy','·∫§t D·∫≠u - Tuy·ªÅn Trung Th·ªßy','B√≠nh Tu·∫•t - ·ªêc Th∆∞·ª£ng Th·ªï','ƒêinh H·ª£i - ·ªêc Th∆∞·ª£ng Th·ªï',
                'M·∫≠u T√Ω - T√≠ch L·ªãch H·ªèa','K·ª∑ S·ª≠u - T√≠ch L·ªãch H·ªèa','Canh D·∫ßn - T√πng B√°ch M·ªôc','T√¢n M√£o - T√πng B√°ch M·ªôc','Nh√¢m Th√¨n - Tr∆∞·ªùng L∆∞u Th·ªßy','Qu√Ω T·ªµ - Tr∆∞·ªùng L∆∞u Th·ªßy',
                'Gi√°p Ng·ªç - Sa Trung Kim','·∫§t M√πi - Sa Trung Kim','B√≠nh Th√¢n - S∆°n H·∫° H·ªèa','ƒêinh D·∫≠u - S∆°n H·∫° H·ªèa','M·∫≠u Tu·∫•t - B√¨nh ƒê·ªãa M·ªôc','K·ª∑ H·ª£i - B√¨nh ƒê·ªãa M·ªôc',
                'Canh T√Ω - B√≠ch Th∆∞·ª£ng Th·ªï','T√¢n S·ª≠u - B√≠ch Th∆∞·ª£ng Th·ªï','Nh√¢m D·∫ßn - Kim B·∫°ch Kim','Qu√Ω M√£o - Kim B·∫°ch Kim','Gi√°p Th√¨n - Ph√∫c ƒêƒÉng H·ªèa','·∫§t T·ªµ - Ph√∫c ƒêƒÉng H·ªèa',
                'B√≠nh Ng·ªç - Thi√™n H√† Th·ªßy','ƒêinh M√πi - Thi√™n H√† Th·ªßy','M·∫≠u Th√¢n - ƒê·∫°i Tr·∫°ch Th·ªï','K·ª∑ D·∫≠u - ƒê·∫°i Tr·∫°ch Th·ªï','Canh Tu·∫•t - Thoa Xuy·∫øn Kim','T√¢n H·ª£i - Thoa Xuy·∫øn Kim',
                'Nh√¢m T√Ω - Tang ƒê·ªë M·ªôc','Qu√Ω S·ª≠u - Tang ƒê·ªë M·ªôc','Gi√°p D·∫ßn - ƒê·∫°i Kh√™ Th·ªßy','·∫§t M√£o - ƒê·∫°i Kh√™ Th·ªßy','B√≠nh Th√¨n - Sa Trung Th·ªï','ƒêinh T·ªµ - Sa Trung Th·ªï',
                'M·∫≠u Ng·ªç - Thi√™n Th∆∞·ª£ng H·ªèa','K·ª∑ M√πi - Thi√™n Th∆∞·ª£ng H·ªèa','Canh Th√¢n - Th·∫°ch L·ª±u M·ªôc','T√¢n D·∫≠u - Th·∫°ch L·ª±u M·ªôc','Nh√¢m Tu·∫•t - ƒê·∫°i H·∫£i Th·ªßy','Qu√Ω H·ª£i - ƒê·∫°i H·∫£i Th·ªßy'
            ];
            const baseYear = 1924;
            let index = (y - baseYear) % 60;
            if (index < 0) index += 60;
            return napAm[index];
        }

        function calcQuai(y, g) {
            let last = y % 100;
            let sum = Math.floor(last / 10) + (last % 10);
            while (sum > 9) sum = Math.floor(sum / 10) + (sum % 10);
            if (sum === 0) sum = 9;
            let n;
            if (y < 2000) {
                if (g === 'nam') {
                    n = 10 - sum;
                } else {
                    n = sum + 5;
                    if (n > 9) n -= 9;
                }
            } else {
                if (g === 'nam') {
                    n = 9 - sum;
                } else {
                    n = sum + 6;
                    if (n > 9) n -= 9;
                }
            }
            if (n === 5) n = g === 'nam' ? 2 : 8;
            if (n === 0) n = 9;
            const q = {1:'Kh·∫£m',2:'Kh√¥n',3:'Ch·∫•n',4:'T·ªën',6:'C√†n',7:'ƒêo√†i',8:'C·∫•n',9:'Ly'};
            return q[n] || 'Kh·∫£m';
        }

        function drawCompass(q, doorDir, doorDeg = null) {
            const s = 750, cx = s/2, r1 = s/2-50;
            
            if (doorDeg === null && doorDir) {
                const directionToDegree = {
                    'B·∫Øc': 0, 'ƒê√¥ng B·∫Øc': 45, 'ƒê√¥ng': 90, 'ƒê√¥ng Nam': 135,
                    'Nam': 180, 'T√¢y Nam': 225, 'T√¢y': 270, 'T√¢y B·∫Øc': 315
                };
                doorDeg = directionToDegree[doorDir];
            }
            
            // 24 h∆∞·ªõng theo La Kinh
            const dirs24 = [
                {name: 'T√Ω', deg: 0, type: 'chi'},
                {name: 'Qu√Ω', deg: 15, type: 'can'},
                {name: 'S·ª≠u', deg: 30, type: 'chi'},
                {name: 'C·∫•n', deg: 45, type: 'quai'},
                {name: 'D·∫ßn', deg: 60, type: 'chi'},
                {name: 'Gi√°p', deg: 75, type: 'can'},
                {name: 'M√£o', deg: 90, type: 'chi'},
                {name: '·∫§t', deg: 105, type: 'can'},
                {name: 'Th√¨n', deg: 120, type: 'chi'},
                {name: 'T·ªën', deg: 135, type: 'quai'},
                {name: 'T·ªµ', deg: 150, type: 'chi'},
                {name: 'B√≠nh', deg: 165, type: 'can'},
                {name: 'Ng·ªç', deg: 180, type: 'chi'},
                {name: 'ƒêinh', deg: 195, type: 'can'},
                {name: 'M√πi', deg: 210, type: 'chi'},
                {name: 'Kh√¥n', deg: 225, type: 'quai'},
                {name: 'Th√¢n', deg: 240, type: 'chi'},
                {name: 'Canh', deg: 255, type: 'can'},
                {name: 'D·∫≠u', deg: 270, type: 'chi'},
                {name: 'T√¢n', deg: 285, type: 'can'},
                {name: 'Tu·∫•t', deg: 300, type: 'chi'},
                {name: 'C√†n', deg: 315, type: 'quai'},
                {name: 'H·ª£i', deg: 330, type: 'chi'},
                {name: 'Nh√¢m', deg: 345, type: 'can'}
            ];
            
            // 24 Sao Ph√∫c ƒê·ª©c
            const phucDucStars = [
                {name: 'Ph√∫c ƒê·ª©c', type: 'cat'}, {name: '√în Ho√†ng', type: 'hung'},
                {name: 'T·∫•n T√†i', type: 'cat'}, {name: 'Tr∆∞·ªùng B·ªánh', type: 'hung'},
                {name: 'T·ªë T·ª•ng', type: 'hung'}, {name: 'Quan T∆∞·ªõc', type: 'cat'},
                {name: 'Quan Qu√Ω', type: 'cat'}, {name: 'T·ª± ·∫¢i', type: 'hung'},
                {name: 'V∆∞·ª£ng Trang', type: 'cat'}, {name: 'H∆∞ng Ph∆∞·ªõc', type: 'cat'},
                {name: 'Ph√°p Tr∆∞·ªùng', type: 'hung'}, {name: 'ƒêi√™n Cu·ªìng', type: 'hung'},
                {name: 'Kh·∫©u Thi·ªát', type: 'hung'}, {name: 'V∆∞·ª£ng T√¢m', type: 'cat'},
                {name: 'T·∫•n ƒêi·ªÅn', type: 'cat'}, {name: 'Kh·ªëc Kh·∫•p', type: 'hung'},
                {name: 'C√¥ Qu·∫£', type: 'hung'}, {name: 'Vinh Ph√∫', type: 'cat'},
                {name: 'Thi·∫øu Vong', type: 'hung'}, {name: 'X∆∞∆°ng D√¢m', type: 'hung'},
                {name: 'Th√¢n H√¥n', type: 'cat'}, {name: 'Hoan L·∫°c', type: 'cat'},
                {name: 'B·∫°i Tuy·ªát', type: 'hung'}, {name: 'V∆∞·ª£ng T√†i', type: 'cat'}
            ];
            
            const phucDucStart = {
                'Kh·∫£m': 'D·∫ßn', 'C·∫•n': 'Gi√°p', 'Ch·∫•n': 'T·ªµ', 'T·ªën': 'T·ªµ',
                'Ly': 'Th√¢n', 'Kh√¥n': 'H·ª£i', 'ƒêo√†i': 'H·ª£i', 'C√†n': 'Th√¢n'
            };
            
            const startPos = phucDucStart[q];
            const startIdx = dirs24.findIndex(d => d.name === startPos);
            
            const stars24 = dirs24.map((dir, i) => {
                const starIdx = (i - startIdx + 24) % 24;
                return {
                    ...phucDucStars[starIdx],
                    position: dir.name,
                    deg: dir.deg
                };
            });
            
            const mainDirs = [
                {name: 'B·∫Øc', deg: 0, quai: 'Kh·∫£m'},
                {name: 'ƒê√¥ng B·∫Øc', deg: 45, quai: 'C·∫•n'},
                {name: 'ƒê√¥ng', deg: 90, quai: 'Ch·∫•n'},
                {name: 'ƒê√¥ng Nam', deg: 135, quai: 'T·ªën'},
                {name: 'Nam', deg: 180, quai: 'Ly'},
                {name: 'T√¢y Nam', deg: 225, quai: 'Kh√¥n'},
                {name: 'T√¢y', deg: 270, quai: 'ƒêo√†i'},
                {name: 'T√¢y B·∫Øc', deg: 315, quai: 'C√†n'}
            ];
            
            const quaiColors = {
                'Kh·∫£m': '#1E90FF', 'C·∫•n': '#8B4513', 'Ch·∫•n': '#228B22', 'T·ªën': '#90EE90',
                'Ly': '#FF4500', 'Kh√¥n': '#DAA520', 'ƒêo√†i': '#FFD700', 'C√†n': '#C0C0C0'
            };
            
            const rings = [
                { r: r1, label: '8 H∆∞·ªõng' },
                { r: r1 - 50, label: '24 Sao Ph√∫c ƒê·ª©c' },
                { r: r1 - 100, label: '24 Cung' },
                { r: r1 - 150, label: 'C√°t/Hung Tinh' },
                { r: r1 - 200, label: '8 Qu·∫ª' }
            ];
            
            const goodDirs = DATA.quai[q].dirs.good;
            const badDirs = DATA.quai[q].dirs.bad;
            
            // X√°c ƒë·ªãnh c√°t/hung cho c·ª≠a ch√≠nh
            let doorIsGood = false;
            let nearestDir = null;
            if (doorDeg !== null && doorDeg !== undefined) {
                let minDiff = 360;
                mainDirs.forEach(dir => {
                    let diff = Math.abs(doorDeg - dir.deg);
                    if (diff > 180) diff = 360 - diff;
                    if (diff < minDiff) {
                        minDiff = diff;
                        nearestDir = dir.name;
                    }
                });
                doorIsGood = goodDirs.includes(nearestDir);
            }
            
            // B·∫Øt ƒë·∫ßu HTML: Ph·∫ßn ƒëi·ªÅu khi·ªÉn la b√†n t∆∞∆°ng t√°c
            let interactiveControls = `
            <div class="compass-interactive-section">
                <h4>üß≠ LA B√ÄN ƒêI·ªÜN T·ª¨ T∆Ø∆†NG T√ÅC</h4>
                <div class="compass-controls">
                    <div class="compass-info-display">
                        <div class="compass-current-heading" id="liveHeadingDisplay">0¬∞</div>
                        <div class="compass-current-direction" id="liveDirectionDisplay">B·∫Øc</div>
                        <div class="compass-status-text" id="compassStatusText">
                            Nh·∫•n "K√≠ch Ho·∫°t La B√†n" ƒë·ªÉ ƒëo h∆∞·ªõng c·ª≠a ch√≠nh
                        </div>
                    </div>
                    <div class="compass-btn-group">
                        <button class="compass-activate-btn" id="activateCompassBtn">
                            üß≠ K√≠ch Ho·∫°t La B√†n
                        </button>
                        <button class="compass-apply-btn" id="applyDirectionBtn" disabled>
                            ‚úì √Åp D·ª•ng H∆∞·ªõng N√†y
                        </button>
                    </div>
                </div>
                <div class="compass-error-message hidden" id="compassErrorMsg"></div>
            </div>`;
            
            // SVG La b√†n
            let svg = `<svg width="${s}" height="${s}" viewBox="0 0 ${s} ${s}" id="interactiveCompassSVG">`;
            
            // Gradient n·ªÅn
            svg += `<defs>
                <radialGradient id="bgGrad">
                    <stop offset="0%" style="stop-color:#FFF8DC;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#F5DEB3;stop-opacity:1" />
                </radialGradient>
            </defs>`;
            svg += `<circle cx="${cx}" cy="${cx}" r="${r1}" fill="url(#bgGrad)"/>`;
            
            // V·∫Ω 5 v√≤ng tr√≤n
            rings.forEach((ring, idx) => {
                const strokeW = idx === 0 ? 4 : 2;
                svg += `<circle cx="${cx}" cy="${cx}" r="${ring.r}" fill="none" stroke="#333" stroke-width="${strokeW}"/>`;
            });
            
            // V·∫Ω m√†u n·ªÅn C√°t/Hung
            mainDirs.forEach((dir) => {
                const isGood = goodDirs.includes(dir.name);
                const a1 = (dir.deg - 22.5 - 90) * Math.PI / 180;
                const a2 = (dir.deg + 22.5 - 90) * Math.PI / 180;
                const sectorColor = isGood ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)';
                
                const x1 = cx + Math.cos(a1) * rings[0].r;
                const y1 = cx + Math.sin(a1) * rings[0].r;
                const x2 = cx + Math.cos(a2) * rings[0].r;
                const y2 = cx + Math.sin(a2) * rings[0].r;
                const x3 = cx + Math.cos(a2) * rings[3].r;
                const y3 = cx + Math.sin(a2) * rings[3].r;
                const x4 = cx + Math.cos(a1) * rings[3].r;
                const y4 = cx + Math.sin(a1) * rings[3].r;
                
                svg += `<path d="M${x1} ${y1}A${rings[0].r} ${rings[0].r} 0 0 1 ${x2} ${y2}L${x3} ${y3}A${rings[3].r} ${rings[3].r} 0 0 0 ${x4} ${y4}Z" fill="${sectorColor}"/>`;
            });
            
            // ƒê∆∞·ªùng chia C√°t/Hung
            mainDirs.forEach((dir) => {
                const a1 = (dir.deg - 22.5 - 90) * Math.PI / 180;
                const x1 = cx + Math.cos(a1) * r1;
                const y1 = cx + Math.sin(a1) * r1;
                svg += `<line x1="${cx}" y1="${cx}" x2="${x1}" y2="${y1}" stroke="#666" stroke-width="2"/>`;
            });
            
            // V√íNG 1: 8 H∆∞·ªõng ch√≠nh
            mainDirs.forEach((dir) => {
                const isGood = goodDirs.includes(dir.name);
                const a = (dir.deg - 90) * Math.PI / 180;
                const tx1 = cx + Math.cos(a) * (r1 + 30);
                const ty1 = cx + Math.sin(a) * (r1 + 30);
                const dirColor = isGood ? '#008000' : '#C62828';
                svg += `<text x="${tx1}" y="${ty1}" text-anchor="middle" dominant-baseline="middle" font-size="15" font-weight="bold" fill="${dirColor}">${dir.name}</text>`;
            });
            
            // V√íNG 2: 24 Sao Ph√∫c ƒê·ª©c
            stars24.forEach((star) => {
                const a = (star.deg - 90) * Math.PI / 180;
                const a1 = (star.deg - 7.5 - 90) * Math.PI / 180;
                
                const xInner = cx + Math.cos(a1) * rings[0].r;
                const yInner = cx + Math.sin(a1) * rings[0].r;
                const xOuter = cx + Math.cos(a1) * rings[1].r;
                const yOuter = cx + Math.sin(a1) * rings[1].r;
                svg += `<line x1="${xInner}" y1="${yInner}" x2="${xOuter}" y2="${yOuter}" stroke="#999" stroke-width="0.5"/>`;
                
                const tx2 = cx + Math.cos(a) * ((rings[0].r + rings[1].r) / 2);
                const ty2 = cx + Math.sin(a) * ((rings[0].r + rings[1].r) / 2);
                const starColor = star.type === 'cat' ? '#2E7D32' : '#C62828';
                svg += `<text x="${tx2}" y="${ty2}" text-anchor="middle" dominant-baseline="middle" font-size="12" font-weight="500" fill="${starColor}">${star.name}</text>`;
            });
            
            // V√íNG 3: 24 Cung
            dirs24.forEach((dir) => {
                const a = (dir.deg - 90) * Math.PI / 180;
                const a1 = (dir.deg - 7.5 - 90) * Math.PI / 180;
                
                const xInner = cx + Math.cos(a1) * rings[1].r;
                const yInner = cx + Math.sin(a1) * rings[1].r;
                const xOuter = cx + Math.cos(a1) * rings[2].r;
                const yOuter = cx + Math.sin(a1) * rings[2].r;
                svg += `<line x1="${xInner}" y1="${yInner}" x2="${xOuter}" y2="${yOuter}" stroke="#999" stroke-width="0.5"/>`;
                
                const tx3 = cx + Math.cos(a) * ((rings[1].r + rings[2].r) / 2);
                const ty3 = cx + Math.sin(a) * ((rings[1].r + rings[2].r) / 2);
                
                let txtColor = '#333';
                if (dir.type === 'quai') txtColor = '#8B0000';
                else if (dir.type === 'can') txtColor = '#00008B';
                
                svg += `<text x="${tx3}" y="${ty3}" text-anchor="middle" dominant-baseline="middle" font-size="12" font-weight="${dir.type === 'quai' ? 'bold' : 'normal'}" fill="${txtColor}">${dir.name}</text>`;
            });
            
            // V√íNG 4: C√°t/Hung Tinh
            mainDirs.forEach((dir) => {
                const isGood = goodDirs.includes(dir.name);
                const a = (dir.deg - 90) * Math.PI / 180;
                const tx4 = cx + Math.cos(a) * ((rings[2].r + rings[3].r) / 2);
                const ty4 = cx + Math.sin(a) * ((rings[2].r + rings[3].r) / 2);
                
                const starIdx = isGood ? goodDirs.indexOf(dir.name) : badDirs.indexOf(dir.name);
                const star = isGood ? (starIdx >= 0 ? STARS[starIdx] : '') : (starIdx >= 0 ? BAD_STARS[starIdx] : '');
                const starColor = isGood ? '#2E7D32' : '#C62828';
                svg += `<text x="${tx4}" y="${ty4}" text-anchor="middle" dominant-baseline="middle" font-size="12" font-weight="600" fill="${starColor}">${star}</text>`;
            });
            
            // V√íNG 5: 8 Qu·∫ª
            mainDirs.forEach((dir) => {
                const a = (dir.deg - 90) * Math.PI / 180;
                const tx5 = cx + Math.cos(a) * ((rings[3].r + rings[4].r) / 2);
                const ty5 = cx + Math.sin(a) * ((rings[3].r + rings[4].r) / 2);
                
                const qColor = quaiColors[dir.quai];
                svg += `<rect x="${tx5-20}" y="${ty5-9}" width="40" height="18" fill="${qColor}" opacity="0.7" rx="3"/>`;
                svg += `<text x="${tx5}" y="${ty5}" text-anchor="middle" dominant-baseline="middle" font-size="12" font-weight="bold" fill="#000">${dir.quai}</text>`;
            });
            
            // TRUNG T√ÇM: T√™n Qu·∫ª
            const centerR = 50;
            svg += `<circle cx="${cx}" cy="${cx}" r="${centerR}" fill="#FFF8DC" stroke="#8B4513" stroke-width="3"/>`;
            svg += `<text x="${cx}" y="${cx}" text-anchor="middle" dominant-baseline="middle" font-size="28" font-weight="bold" fill="#8B4513">${q}</text>`;
            
            // V·∫Ω ƒë·ªô s·ªë (0-360¬∞)
            for (let deg = 0; deg < 360; deg++) {
                const a = (deg - 90) * Math.PI / 180;
                const xInner = cx + Math.cos(a) * (r1 - 5);
                const yInner = cx + Math.sin(a) * (r1 - 5);
                const xOuter = cx + Math.cos(a) * r1;
                const yOuter = cx + Math.sin(a) * r1;
                
                svg += `<line x1="${xInner}" y1="${yInner}" x2="${xOuter}" y2="${yOuter}" stroke="#666" stroke-width="0.3"/>`;
                
                if (deg % 10 === 0) {
                    const tx = cx + Math.cos(a) * (r1 + 15);
                    const ty = cx + Math.sin(a) * (r1 + 15);
                    svg += `<text x="${tx}" y="${ty}" text-anchor="middle" dominant-baseline="middle" font-size="9" fill="#444">${deg}¬∞</text>`;
                }
            }
            
            // M≈®I T√äN H∆Ø·ªöNG C·ª¨A (n·∫øu c√≥)
                if (doorDeg !== null && doorDeg !== undefined) {
                    const arrowAngle = (doorDeg - 90) * Math.PI / 180;
                    const arrowColor = doorIsGood ? '#00C853' : '#FF1744';
                    const arrowWidth = 6;
                    
                    const startX = cx + Math.cos(arrowAngle) * 60;
                    const startY = cx + Math.sin(arrowAngle) * 60;
                    const endX = cx + Math.cos(arrowAngle) * (r1 - 215);
                    const endY = cx + Math.sin(arrowAngle) * (r1 - 215);
                    
                    svg += `<line x1="${startX}" y1="${startY}" x2="${endX}" y2="${endY}" stroke="${arrowColor}" stroke-width="${arrowWidth}" stroke-linecap="round" opacity="0.9"/>`;
                    
                    const arrowHeadLength = 18;
                    const arrowHeadAngle = 25 * Math.PI / 180;
                    const leftX = endX - arrowHeadLength * Math.cos(arrowAngle - arrowHeadAngle);
                    const leftY = endY - arrowHeadLength * Math.sin(arrowAngle - arrowHeadAngle);
                    const rightX = endX - arrowHeadLength * Math.cos(arrowAngle + arrowHeadAngle);
                    const rightY = endY - arrowHeadLength * Math.sin(arrowAngle + arrowHeadAngle);
                    
                    svg += `<polygon points="${endX},${endY} ${leftX},${leftY} ${rightX},${rightY}" fill="${arrowColor}" opacity="0.9"/>`;
                    
                    const labelX = cx + Math.cos(arrowAngle) * (r1 + 45);
                    const labelY = cx + Math.sin(arrowAngle) * (r1 + 45);
                    
                    svg += `<circle cx="${labelX}" cy="${labelY}" r="28" fill="${arrowColor}" opacity="0.95" stroke="white" stroke-width="2"/>`;
                    svg += `<text x="${labelX}" y="${labelY - 6}" text-anchor="middle" dominant-baseline="middle" font-size="13" font-weight="bold" fill="#FFF">${doorDeg}¬∞</text>`;
                    svg += `<text x="${labelX}" y="${labelY + 9}" text-anchor="middle" dominant-baseline="middle" font-size="10" font-weight="bold" fill="#FFF">${doorIsGood ? 'C√ÅT' : 'HUNG'}</text>`;
                }
                
                
                svg += `</svg>`;
            // Ch√∫ th√≠ch
                const legend = `
                    <div style="margin-top: 30px;">
                        <h4 style="text-align: center; color: #667eea; margin-bottom: 10px;">üìä La B√†n Phong Th·ªßy - Qu·∫ª ${q}</h4>
                        <p style="text-align: center; font-size: 12px; color: #666; margin-bottom: 15px;">
                        <strong>V√≤ng 1:</strong> 8 H∆∞·ªõng | <strong>V√≤ng 2:</strong> 24 Sao Ph√∫c ƒê·ª©c (kh·ªüi an t·∫°i <strong>${startPos}</strong>) | 
                        <strong>V√≤ng 3:</strong> 24 Cung (Thi√™n Can-ƒê·ªãa Chi) | <strong>V√≤ng 4:</strong> C√°t/Hung Tinh | <strong>V√≤ng 5:</strong> 8 Qu·∫ª | 
                        <strong>Trung T√¢m:</strong> ${q}
                        <br><span style="color: #00008B;">‚ñ† Thi√™n Can</span> | <span style="color: #333;">‚ñ† ƒê·ªãa Chi</span> | <span style="color: #8B0000;">‚ñ† Qu·∫ª</span>
                        <br><span style="color: #2E7D32;">‚ñ† C√°t Tinh/Sao</span> | <span style="color: #C62828;">‚ñ† Hung Tinh/Sao</span>
                        <br><span style="background: rgba(76, 175, 80, 0.2); padding: 2px 8px;">‚ñ† V√πng C√°t</span> | <span style="background: rgba(244, 67, 54, 0.2); padding: 2px 8px;">‚ñ† V√πng Hung</span>
                        ${doorDeg !== null && doorDeg !== undefined ? `<br><strong style="color: ${doorIsGood ? '#00C853' : '#FF1744'};">‚Üí H∆∞·ªõng c·ª≠a ch√≠nh: ${doorDeg}¬∞ (${doorIsGood ? 'C√ÅT' : 'HUNG'})</strong>` : ''}
                        <br><strong style="color: #e74c3c;">üß≠ Kim ƒë·ªè:</strong> H∆∞·ªõng ƒëang ƒëo (k√≠ch ho·∫°t la b√†n ƒë·ªÉ ƒëo h∆∞·ªõng th·ª±c t·∫ø)
                    </p>
                    <div class="compass-svg-container" style="position: relative;">
                        <!-- M≈®I T√äN C·ªê ƒê·ªäNH NGO√ÄI SVG -->
                        <div id="interactiveCompassNeedle" style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            width: 4px;
                            height: 220px;
                            margin-left: -2px;
                            margin-top: -110px;
                            opacity: 0;
                            pointer-events: none;
                            transition: opacity 0.3s;
                            transform-origin: 2px 110px;
                        ">
                            <!-- ƒêu√¥i x√°m -->
                            <div style="
                                position: absolute;
                                width: 4px;
                                height: 60px;
                                background: #95a5a6;
                                left: 0;
                                top: 110px;
                                border-radius: 2px;
                            "></div>
                            <!-- M≈©i ƒë·ªè -->
                            <div style="
                                position: absolute;
                                width: 4px;
                                height: 110px;
                                background: #e74c3c;
                                left: 0;
                                top: 0;
                                border-radius: 2px;
                            "></div>
                            <!-- ƒê·∫ßu m≈©i t√™n -->
                            <div style="
                                position: absolute;
                                width: 0;
                                height: 0;
                                border-left: 8px solid transparent;
                                border-right: 8px solid transparent;
                                border-bottom: 14px solid #e74c3c;
                                left: -6px;
                                top: -14px;
                            "></div>
                            <!-- T√¢m -->
                            <div style="
                                position: absolute;
                                width: 12px;
                                height: 12px;
                                background: #333;
                                border-radius: 50%;
                                left: -4px;
                                top: 104px;
                                box-shadow: 0 0 0 2px white;
                            "></div>
                        </div>
                        
                        <!-- LABEL ƒê·ªò -->
                        <div id="compassDegreeLabel" style="
                            position: absolute;
                            top: 10%;
                            left: 50%;
                            transform: translateX(-50%);
                            opacity: 0;
                            transition: opacity 0.3s;
                            background: rgba(231, 76, 60, 0.9);
                            padding: 8px 16px;
                            border-radius: 8px;
                            color: white;
                            font-weight: bold;
                            font-size: 16px;
                            white-space: nowrap;
                            pointer-events: none;
                            z-index: 100;
                        " id="needleDegreeText">0¬∞ - B·∫Øc</div>
                        
                        ${svg}
                    </div>
                    <div class="compass-controls-bottom">
                        <button class="compass-btn-control compass-btn-activate" id="activateCompassBtn">
                            üß≠ K√≠ch Ho·∫°t La B√†n
                        </button>
                        <button class="compass-btn-control compass-btn-apply" id="applyDirectionBtn" disabled>
                            ‚úì √Åp D·ª•ng H∆∞·ªõng N√†y
                        </button>
                    </div>
                    <div class="compass-error-msg hidden" id="compassErrorMsg"></div>
                </div>`;
                
                return legend;
            }
        function getDoorExplanation(q, doorDir) {
            const qd = DATA.quai[q];
            const isGood = qd.dirs.good.includes(doorDir);
            const idx = isGood ? qd.dirs.good.indexOf(doorDir) : qd.dirs.bad.indexOf(doorDir);
            
            if (isGood) {
                const starNames = ['Sinh Kh√≠ (t√†i v·∫≠n)', 'Thi√™n Y (s·ª©c kh·ªèe)', 'Di√™n Ni√™n (h√¥n nh√¢n)', 'Ph·ª•c V·ªã (b√¨nh an)'];
                return `‚úÖ <strong>H∆Ø·ªöNG T·ªêT!</strong><br>C·ª≠a ch√≠nh h∆∞·ªõng <span class="highlight">${doorDir}</span> l√† h∆∞·ªõng <strong>${starNames[idx]}</strong><br>${STAR_DESC[idx]}<br><em style="color: #4CAF50;">C·ª≠a n√†y s·∫Ω ƒë√≥n t√†i kh√≠ v√†o nh√†, r·∫•t thu·∫≠n l·ª£i!</em>`;
            } else {
                const badNames = ['Tuy·ªát M·ªánh', 'Ng≈© Qu·ª∑', 'L·ª•c S√°t', 'H·ªça H·∫°i'];
                return `‚ö†Ô∏è <strong>H∆Ø·ªöNG X·∫§U!</strong><br>C·ª≠a ch√≠nh h∆∞·ªõng <span class="highlight">${doorDir}</span> l√† h∆∞·ªõng <strong>${badNames[idx]}</strong><br>${BAD_DESC[idx]}<br><em style="color: #f44336;">N√™n xem x√©t thay ƒë·ªïi ho·∫∑c c·∫£i thi·ªán b·∫±ng v·∫≠t phong th·ªßy.</em>`;
            }
        }

        function renderSection(title, content) {
            const section = document.createElement('div');
            section.className = 'result-card';
            section.innerHTML = `<h2>${title}</h2>${content}`;
            return section;
        }

        function calculateFengShui() {
            const y = parseInt(document.getElementById('year').value);
            const g = document.getElementById('gender').value;
            const doorDir = document.getElementById('doorDir').value;
            const errorDiv = document.getElementById('error-message');
            
            if (isNaN(y) || y < 1900 || y > 2100) {
                errorDiv.textContent = 'NƒÉm sinh ph·∫£i l√† s·ªë h·ª£p l·ªá t·ª´ 1900 ƒë·∫øn 2100!';
                errorDiv.style.display = 'block';
                return;
            }
            if (!g || !['nam', 'nu'].includes(g)) {
                errorDiv.textContent = 'Vui l√≤ng ch·ªçn gi·ªõi t√≠nh!';
                errorDiv.style.display = 'block';
                return;
            }
            if (!doorDir || !['B·∫Øc', 'ƒê√¥ng B·∫Øc', 'ƒê√¥ng', 'ƒê√¥ng Nam', 'Nam', 'T√¢y Nam', 'T√¢y', 'T√¢y B·∫Øc'].includes(doorDir)) {
                errorDiv.textContent = 'Vui l√≤ng ch·ªçn h∆∞·ªõng c·ª≠a ch√≠nh!';
                errorDiv.style.display = 'block';
                return;
            }
            errorDiv.style.display = 'none';

            const m = calcMenh(y);
            let mt = 'Th·ªï';
            if (m.includes('Kim')) mt = 'Kim';
            else if (m.includes('M·ªôc')) mt = 'M·ªôc';
            else if (m.includes('Th·ªßy')) mt = 'Th·ªßy';
            else if (m.includes('H·ªèa')) mt = 'H·ªèa';
            
            const q = calcQuai(y, g);
            const qd = DATA.quai[q];
            const md = DATA.menh[mt];

            const fragment = document.createDocumentFragment();

            // Section Th√¥ng Tin M·ªánh & Qu√°i S·ªë
            fragment.appendChild(renderSection('üåü Th√¥ng Tin M·ªánh & Qu√°i S·ªë', `
                <div class="info-box">
                    <strong>M·ªánh c·ªßa b·∫°n:</strong> <span class="element-tag ${md.element}">${m}</span>
                    <br><strong>Qu√°i s·ªë:</strong> ${q}
                    <br><strong>Nh√≥m T·ª© Tr·∫°ch:</strong> ${qd.group}
                </div>
                <div class="detail-box"><strong>üìñ Gi·∫£i th√≠ch:</strong><br>${qd.explain}</div>
            `));

            // Section Phong Th·ªßy C·ª≠a Ch√≠nh
            fragment.appendChild(renderSection('üè† Phong Th·ªßy C·ª≠a Ch√≠nh Nh√† B·∫°n', `
                <div class="info-box" style="border-left-color: #FF6B00;">
                    <strong>H∆∞·ªõng c·ª≠a ch√≠nh:</strong> <span class="highlight" style="background: #FFE4D6; color: #FF6B00;">üö™ ${doorDir}</span>
                    <br><br>${getDoorExplanation(q, doorDir)}
                </div>
            `));

            // Section La B√†n v·ªõi L√° B√°t Qu√°i
            let compassHtml = `
                <div class="compass-section">
                    <div style="width: 100%; max-width: 500px;">${drawCompass(q, doorDir, preciseDoorDegree)}</div>
                    <div class="direction-note">
                        üö™ = V·ªã tr√≠ c·ª≠a ch√≠nh c·ªßa b·∫°n | Sinh Kh√≠, Thi√™n Y, Di√™n Ni√™n, Ph·ª•c V·ªã = H∆∞·ªõng t·ªët (xanh) | Tuy·ªát M·ªánh, Ng≈© Qu·ª∑, L·ª•c S√°t, H·ªça H·∫°i = H∆∞·ªõng x·∫•u (ƒë·ªè)<br>
                        C√°c qu·∫ª (Kh·∫£m, C·∫•n, Ch·∫•n, T·ªën, Ly, Kh√¥n, ƒêo√†i, C√†n) th·ªÉ hi·ªán nƒÉng l∆∞·ª£ng c·ªßa t·ª´ng h∆∞·ªõng.
                    </div>
                    <h3>üåü T·ª© C√°t Tinh (H∆∞·ªõng T·ªët):</h3>`;
            for (let i = 0; i < 4; i++) {
                compassHtml += `<div class="info-box" style="background:#f1f8f4;border-left-color:#4CAF50">
                    <strong>‚≠ê ${STARS[i]} - H∆∞·ªõng <span class="highlight">${qd.dirs.good[i]}</span></strong><br>${STAR_DESC[i]}
                </div>`;
            }
            compassHtml += `<h3>üíÄ T·ª© Hung Tinh (H∆∞·ªõng X·∫•u):</h3>`;
            for (let i = 0; i < 4; i++) {
                compassHtml += `<div class="info-box" style="background:#fff5f5;border-left-color:#f44336">
                    <strong>üíÄ ${BAD_STARS[i]} - H∆∞·ªõng <span class="highlight">${qd.dirs.bad[i]}</span></strong><br>${BAD_DESC[i]}
                </div>`;
            }
            compassHtml += `</div>`;
            fragment.appendChild(renderSection('üß≠ La B√†n 8 H∆∞·ªõng & L√° B√°t Qu√°i', compassHtml));

            // Section Ph√≤ng B·∫øp
            fragment.appendChild(renderSection('üç≥ Phong Th·ªßy Ph√≤ng B·∫øp', `
                <div class="info-box"><strong>üéØ H∆∞·ªõng T·ªêT NH·∫§T:</strong> ƒê·∫∑t b·∫øp ·ªü h∆∞·ªõng <span class="highlight">${qd.dirs.bad[1]}</span> (Ng≈© Qu·ª∑) ho·∫∑c <span class="highlight">${qd.dirs.bad[2]}</span> (L·ª•c S√°t) ƒë·ªÉ √©p hung kh√≠</div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·ª≠a Ph√≤ng B·∫øp (Theo L·ªó Ban 52.2cm - D∆∞∆°ng Tr·∫°ch):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">52.2cm</span> - Ph√°t l·ªôc<br>
                    ‚Ä¢ <span class="highlight">78.3cm</span> - T√†i v·∫≠n<br>
                    ‚Ä¢ <span class="highlight">104.4cm</span> - Sinh kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">156.6cm</span> - V∆∞·ª£ng<br>
                    ‚Ä¢ <span class="highlight">208.8cm</span> - Sinh kh√≠<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">104.4cm √ó 208.8cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ƒë·∫∑t b·∫øp:</h4>
                    <strong>Nguy√™n t·∫Øc:</strong> B·∫øp n√™n ƒë·∫∑t ·ªü h∆∞·ªõng X·∫§U ƒë·ªÉ "ƒë·ªët ch√°y" hung kh√≠<br>
                    <strong>V·ªã tr√≠ t·ªët nh·∫•t:</strong> Ph√≤ng b·∫øp ·ªü ph√≠a <span class="highlight">${qd.dirs.bad[1]}</span> ho·∫∑c <span class="highlight">${qd.dirs.bad[2]}</span> c·ªßa nh√†<br>
                    <strong>C√≥ th·ªÉ ch·∫•p nh·∫≠n:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.bad[3]}</span> (H·ªça H·∫°i)
                    
                    <h4>üî• H∆∞·ªõng mi·ªáng b·∫øp khi n·∫•u:</h4>
                    <strong>Mi·ªáng b·∫øp h∆∞·ªõng:</strong> <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) khi n·∫•u n∆∞·ªõng<br>
                    <em class="direction-note">"Mi·ªáng b·∫øp" l√† h∆∞·ªõng m√† b·∫°n ƒë·ª©ng n·∫•u, ngu·ªìn l·ª≠a/nhi·ªát h∆∞·ªõng v√†o</em><br>
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t m·ªôt l∆∞ h∆∞∆°ng nh·ªè b·∫±ng g·ªëm ho·∫∑c ƒë·ªìng ·ªü g√≥c <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) ƒë·ªÉ thu h√∫t t√†i l·ªôc.<br>
                    - ƒê·∫∑t b√¨nh phong ho·∫∑c c√¢y l∆∞·ª°i h·ªï ·ªü c·ª≠a b·∫øp h∆∞·ªõng <span class="highlight">${qd.dirs.bad[0]}</span> (Tuy·ªát M·ªánh) ƒë·ªÉ h√≥a gi·∫£i nƒÉng l∆∞·ª£ng x·∫•u.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>B·∫øp KH√îNG ƒë∆∞·ª£c ƒë·ªëi di·ªán c·ª≠a ch√≠nh</li>
                        <li>Tr√°nh ƒë·∫∑t b·∫øp d∆∞·ªõi nh√† v·ªá sinh t·∫ßng tr√™n</li>
                        <li>Kh√¥ng ƒë·ªÉ b·∫øp ƒë·ªëi th·∫≥ng ph√≤ng ng·ªß</li>
                        <li>B·∫øp kh√¥ng n√™n n·∫±m gi·ªØa nh√†</li>
                        <li>Lu√¥n gi·ªØ b·∫øp s·∫°ch s·∫Ω, tho√°ng m√°t</li>
                    </ul>
                </div>
            `));

            // Section Ph√≤ng T·∫Øm & WC
            fragment.appendChild(renderSection('üöø Phong Th·ªßy Ph√≤ng T·∫Øm & WC', `
                <div class="info-box"><strong>üéØ Nguy√™n t·∫Øc:</strong> ƒê·∫∑t ·ªü h∆∞·ªõng X·∫§U ƒë·ªÉ h√≥a gi·∫£i hung kh√≠</div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·ª≠a Ph√≤ng T·∫Øm/WC (Theo L·ªó Ban 52.2cm - D∆∞∆°ng Tr·∫°ch):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">52.2cm</span> - Ph√°t l·ªôc<br>
                    ‚Ä¢ <span class="highlight">78.3cm</span> - T√†i v·∫≠n<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">156.6cm</span> - V∆∞·ª£ng<br>
                    ‚Ä¢ <span class="highlight">208.8cm</span> - Sinh kh√≠<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">78.3cm √ó 208.8cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ph√π h·ª£p:</h4>
                    <strong>V·ªã tr√≠ t·ªët nh·∫•t:</strong> ƒê·∫∑t toilet/nh√† t·∫Øm ·ªü ph√≠a <span class="highlight">${qd.dirs.bad[1]}</span> ho·∫∑c <span class="highlight">${qd.dirs.bad[2]}</span><br>
                    <strong>C√≥ th·ªÉ ch·∫•p nh·∫≠n:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.bad[0]}</span> ho·∫∑c <span class="highlight">${qd.dirs.bad[3]}</span><br>
                    <strong>Nguy√™n t·∫Øc:</strong> Toilet ƒë·∫∑t ·ªü h∆∞·ªõng x·∫•u ƒë·ªÉ "x·∫£" hung kh√≠ ra ngo√†i
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t m·ªôt vi√™n th·∫°ch anh ƒëen ho·∫∑c obsidian ·ªü g√≥c <span class="highlight">${qd.dirs.bad[0]}</span> (Tuy·ªát M·ªánh) g·∫ßn b·ªìn r·ª≠a ƒë·ªÉ h√∫t nƒÉng l∆∞·ª£ng ti√™u c·ª±c.<br>
                    - Treo chu√¥ng gi√≥ kim lo·∫°i ·ªü c·ª≠a ph√≤ng t·∫Øm h∆∞·ªõng <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) ƒë·ªÉ c√¢n b·∫±ng kh√≠.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>LU√îN ƒë√≥ng n·∫Øp b·ªìn c·∫ßu v√† c·ª≠a toilet</li>
                        <li>Ph·∫£i c√≥ c·ª≠a s·ªï ho·∫∑c h·ªá th·ªëng th√¥ng gi√≥ t·ªët</li>
                        <li>Gi·ªØ kh√¥ r√°o, s·∫°ch s·∫Ω th∆∞·ªùng xuy√™n</li>
                        <li>Tuy·ªát ƒë·ªëi KH√îNG ƒë·ªÉ toilet ·ªü trung t√¢m nh√†</li>
                        <li>Kh√¥ng ƒë·ªÉ toilet ƒë·ªëi di·ªán b·∫øp ho·∫∑c b√†n th·ªù</li>
                    </ul>
                </div>
            `));

            // Section Ph√≤ng L√†m Vi·ªác
            fragment.appendChild(renderSection('üìö Phong Th·ªßy Ph√≤ng L√†m Vi·ªác', `
                <div class="info-box"><strong>üéØ H∆∞·ªõng T·ªêT NH·∫§T:</strong> <span class="highlight">${qd.dirs.good[0]} (Sinh Kh√≠)</span> - t·ªët nh·∫•t cho c√¥ng vi·ªác, t√†i v·∫≠n</div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·ª≠a Ph√≤ng L√†m Vi·ªác (Theo L·ªó Ban 52.2cm - D∆∞∆°ng Tr·∫°ch):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">78.3cm</span> - T√†i v·∫≠n<br>
                    ‚Ä¢ <span class="highlight">104.4cm</span> - Sinh kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">208.8cm</span> - Sinh kh√≠<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">104.4cm √ó 208.8cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ph√≤ng l√†m vi·ªác:</h4>
                    <strong>T·ªët nh·∫•t:</strong> Ph√≤ng l√†m vi·ªác ·ªü ph√≠a <span class="highlight">${qd.dirs.good[0]}</span> c·ªßa nh√† (Sinh Kh√≠ - v∆∞·ª£ng s·ª± nghi·ªáp)<br>
                    <strong>L·ª±a ch·ªçn 2:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y - t·ªët n·∫øu c√¥ng vi·ªác √°p l·ª±c)<br>
                    <strong>L·ª±a ch·ªçn 3:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã - c√¥ng vi·ªác ·ªïn ƒë·ªãnh)
                    
                    <h4>üíº H∆∞·ªõng ng·ªìi l√†m vi·ªác:</h4>
                    <strong>H∆∞·ªõng ng·ªìi t·ªët nh·∫•t:</strong> Ng·ªìi h∆∞·ªõng m·∫∑t v·ªÅ <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠)<br>
                    <strong>H∆∞·ªõng ng·ªìi thay th·∫ø:</strong> C√≥ th·ªÉ ng·ªìi h∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[1]}</span> ho·∫∑c <span class="highlight">${qd.dirs.good[2]}</span><br>
                    <em class="direction-note">"H∆∞·ªõng ng·ªìi" l√† h∆∞·ªõng b·∫°n nh√¨n v·ªÅ khi ng·ªìi l√†m vi·ªác</em>
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t th·∫°ch anh v√†ng ho·∫∑c citrine tr√™n b√†n l√†m vi·ªác ·ªü g√≥c <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) ƒë·ªÉ tƒÉng t√†i v·∫≠n.<br>
                    - ƒê·∫∑t t∆∞·ª£ng Ph·∫≠t ho·∫∑c c√¢y kim ng√¢n ·ªü g√≥c <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) ƒë·ªÉ h·ªó tr·ª£ s·ª©c kh·ªèe tinh th·∫ßn.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>üìè K√≠ch Th∆∞·ªõc B√†n L√†m Vi·ªác (Theo L·ªó Ban 42.9cm):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">81.5cm</span> - T√†i l·ªôc<br>
                    ‚Ä¢ <span class="highlight">107.2cm</span> - V∆∞·ª£ng kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu s√¢u (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">42.9cm</span> - Ph√°t t√†i<br>
                    ‚Ä¢ <span class="highlight">64.3cm</span> - Sinh kh√≠<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">81.5cm</span> - V∆∞·ª£ng<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">107.2cm √ó 64.3cm √ó 81.5cm</span>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>B√†n l√†m vi·ªác PH·∫¢I t·ª±a l∆∞ng v√†o t∆∞·ªùng</li>
                        <li>KH√îNG ng·ªìi quay l∆∞ng v·ªÅ ph√≠a c·ª≠a</li>
                        <li>N√™n c√≥ √°nh s√°ng t·ª± nhi√™n t·ª´ b√™n tr√°i</li>
                        <li>Tr√°nh ng·ªìi d∆∞·ªõi d·∫ßm ho·∫∑c ƒë√®n treo</li>
                        <li>B√†n l√†m vi·ªác g·ªçn g√†ng, c√≥ c√¢y xanh</li>
                    </ul>
                </div>
            `));

            // Section Ph√≤ng Th·ªù & B√†n Th·ªù
            fragment.appendChild(renderSection('üôè Phong Th·ªßy Ph√≤ng Th·ªù & B√†n Th·ªù', `
                <div class="info-box"><strong>üéØ H∆∞·ªõng T·ªêT NH·∫§T:</strong> <span class="highlight">${qd.dirs.good[0]} (Sinh Kh√≠)</span> ho·∫∑c <span class="highlight">${qd.dirs.good[1]} (Thi√™n Y)</span></div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc B√†n Th·ªù (Theo L·ªó Ban 38.8cm - √Çm Tr·∫°ch):</h4>
                    <strong>B√†n th·ªù nh·ªè:</strong><br>
                    ‚Ä¢ Chi·ªÅu r·ªông: <span class="highlight">48cm</span> - H·ª∑ s·ª±<br>
                    ‚Ä¢ Chi·ªÅu s√¢u: <span class="highlight">48cm</span> - H·ª∑ s·ª±<br>
                    ‚Ä¢ Chi·ªÅu cao: <span class="highlight">108cm</span> - T√†i v∆∞·ª£ng<br>
                    <strong>B√†n th·ªù trung b√¨nh (T·ªêT NH·∫§T):</strong><br>
                    ‚Ä¢ Chi·ªÅu r·ªông: <span class="highlight">88cm</span> - Ti·∫øn b·∫£o<br>
                    ‚Ä¢ Chi·ªÅu s√¢u: <span class="highlight">61cm</span> - T√†i v∆∞·ª£ng<br>
                    ‚Ä¢ Chi·ªÅu cao: <span class="highlight">127cm</span> - ƒê·∫°i c√°t<br>
                    <strong>B√†n th·ªù l·ªõn:</strong><br>
                    ‚Ä¢ Chi·ªÅu r·ªông: <span class="highlight">107cm</span> - T√†i v∆∞·ª£ng<br>
                    ‚Ä¢ Chi·ªÅu s√¢u: <span class="highlight">69cm</span> - Th√™m ph√∫c<br>
                    ‚Ä¢ Chi·ªÅu cao: <span class="highlight">153cm</span> - ƒê·∫°i c√°t<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #FFE4D6; padding: 5px 10px; border-radius: 5px; font-weight: bold;">88cm √ó 61cm √ó 127cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ƒë·∫∑t b√†n th·ªù:</h4>
                    <strong>V·ªã tr√≠ t·ªët nh·∫•t:</strong> ƒê·∫∑t b√†n th·ªù ·ªü ph√≠a <span class="highlight">${qd.dirs.good[0]}</span> c·ªßa nh√† (Sinh Kh√≠ - v∆∞·ª£ng ph√∫c l·ªôc)<br>
                    <strong>V·ªã tr√≠ t·ªët th·ª© 2:</strong> ƒê·∫∑t b√†n th·ªù ·ªü ph√≠a <span class="highlight">${qd.dirs.good[1]}</span> c·ªßa nh√† (Thi√™n Y - che ch·ªü s·ª©c kh·ªèe)<br>
                    <strong>V·ªã tr√≠ thay th·∫ø:</strong> C√≥ th·ªÉ ƒë·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã - b√¨nh an)<br>
                    <strong>‚ö†Ô∏è TUY·ªÜT ƒê·ªêI TR√ÅNH:</strong> Kh√¥ng ƒë·∫∑t b√†n th·ªù ·ªü ph√≠a <span style="color:#f44336;font-weight:bold">${qd.dirs.bad[0]}</span> (Tuy·ªát M·ªánh) ho·∫∑c <span style="color:#f44336;font-weight:bold">${qd.dirs.bad[1]}</span> (Ng≈© Qu·ª∑)
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t b√°t h∆∞∆°ng ho·∫∑c t∆∞·ª£ng Ph·∫≠t ·ªü g√≥c <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) tr√™n b√†n th·ªù ƒë·ªÉ tƒÉng ph√∫c l·ªôc.<br>
                    - ƒê·∫∑t ƒë√®n d·∫ßu ho·∫∑c n·∫øn nh·ªè ·ªü g√≥c <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) ƒë·ªÉ c·∫ßu s·ª©c kh·ªèe cho gia ƒë√¨nh.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>üß≠ H∆∞·ªõng b√†n th·ªù (h∆∞·ªõng m·∫∑t t∆∞·ª£ng/·∫£nh):</h4>
                    <strong>H∆∞·ªõng t·ªët nh·∫•t:</strong> T∆∞·ª£ng/·∫£nh tr√™n b√†n th·ªù n√™n h∆∞·ªõng m·∫∑t v·ªÅ <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠)<br>
                    <strong>H∆∞·ªõng t·ªët th·ª© 2:</strong> C√≥ th·ªÉ h∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y)<br>
                    <strong>H∆∞·ªõng thay th·∫ø:</strong> H∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[2]}</span> (Di√™n Ni√™n) ho·∫∑c <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã)<br>
                    <em class="direction-note">L∆∞u √Ω: "H∆∞·ªõng b√†n th·ªù" l√† h∆∞·ªõng m·∫∑t c·ªßa t∆∞·ª£ng/·∫£nh tr√™n b√†n th·ªù nh√¨n ra</em>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>B√†n th·ªù PH·∫¢I ƒë·∫∑t ·ªü v·ªã tr√≠ cao nh·∫•t trong nh√†</li>
                        <li>KH√îNG ƒë·∫∑t d∆∞·ªõi nh√† v·ªá sinh/ph√≤ng ng·ªß t·∫ßng tr√™n</li>
                        <li>KH√îNG ƒë·ªÉ b√†n th·ªù quay v·ªÅ ph√≠a toilet</li>
                        <li>Ph√≠a sau b√†n th·ªù n√™n l√† t∆∞·ªùng v·ªØng ch·∫Øc</li>
                        <li>KH√îNG ƒë·∫∑t b√†n th·ªù s√°t c·ª≠a ra v√†o</li>
                        <li>Tr√°nh ƒë·ªÉ b√†n th·ªù d∆∞·ªõi g·∫ßm c·∫ßu thang</li>
                        <li>Lu√¥n gi·ªØ b√†n th·ªù s·∫°ch s·∫Ω, trang nghi√™m</li>
                    </ul>
                </div>
            `));

            // Section C·∫ßu Thang
            fragment.appendChild(renderSection('ü™ú Phong Th·ªßy C·∫ßu Thang', `
                <div class="info-box"><strong>üéØ Nguy√™n t·∫Øc:</strong> C·∫ßu thang n√™n ƒë·∫∑t ·ªü v·ªã tr√≠ h∆∞·ªõng <span class="highlight">${qd.dirs.bad[0]}</span> (Tuy·ªát M·ªánh) ho·∫∑c <span class="highlight">${qd.dirs.bad[1]}</span> (Ng≈© Qu·ª∑)</div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·∫ßu Thang (Theo L·ªó Ban 42.9cm):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">85.8cm</span> - T√†i l·ªôc<br>
                    ‚Ä¢ <span class="highlight">107.2cm</span> - V∆∞·ª£ng kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu cao b·∫≠c (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">17.2cm</span> - T√†i v∆∞·ª£ng<br>
                    ‚Ä¢ <span class="highlight">21.5cm</span> - ƒê·∫°i c√°t<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">107.2cm √ó 21.5cm (b·∫≠c)</span>
            
                    <h4>üî¢ S·ªë B·∫≠c C·∫ßu Thang (Theo Phong Th·ªßy):</h4>
                    <strong>Nguy√™n t·∫Øc:</strong> S·ªë b·∫≠c n√™n r∆°i v√†o cung <strong>Sinh</strong> ho·∫∑c <strong>L√£o</strong> trong chu k·ª≥ Sinh - L√£o - B·ªánh - T·ª≠<br>
                    <strong>S·ªë b·∫≠c t·ªët nh·∫•t:</strong><br>
                    ‚Ä¢ <span class="highlight">17 b·∫≠c</span> - Cung Sinh (t√†i l·ªôc, s·ª©c s·ªëng)<br>
                    ‚Ä¢ <span class="highlight">21 b·∫≠c</span> - Cung Sinh (r·∫•t t·ªët, v∆∞·ª£ng kh√≠)<br>
                    ‚Ä¢ <span class="highlight">22 b·∫≠c</span> - Cung L√£o (·ªïn ƒë·ªãnh, b·ªÅn v·ªØng)<br>
                    ‚Ä¢ <span class="highlight">25 b·∫≠c</span> - Cung Sinh (t√†i l·ªôc d·ªìi d√†o)<br>
                    ‚Ä¢ - B·∫≠c ƒë·∫ßu ti√™n m√† ch√¢n b·∫°n b∆∞·ªõc l√™n, n√¢ng cao h∆°n m·∫∑t s√†n t·∫ßng.<br>
                    ‚Ä¢ - B·∫≠c cu·ªëi c√πng ƒê√¢y l√† b·∫≠c cao nh·∫•t c·ªßa c·∫ßu thang. Khi b·∫°n ƒë·ª©ng tr√™n b·∫≠c n√†y, b∆∞·ªõc ti·∫øp theo b·∫°n s·∫Ω b∆∞·ªõc ra m·∫∑t s√†n t·∫ßng tr√™n. <br>
                    ‚Ä¢ - L∆∞u √Ω: M·∫∑t s√†n c·ªßa t·∫ßng: KH√îNG ƒë∆∞·ª£c t√≠nh l√† m·ªôt b·∫≠c c·∫ßu thang <br>
                    <strong>S·ªë b·∫≠c c·∫ßn tr√°nh:</strong><br>
                    ‚Ä¢ <span class="highlight" style="background: #fff5f5; color: #f44336;">19 b·∫≠c</span> - Cung B·ªánh (s·ª©c kh·ªèe k√©m)<br>
                    ‚Ä¢ <span class="highlight" style="background: #fff5f5; color: #f44336;">20 b·∫≠c</span> - Cung T·ª≠ (nƒÉng l∆∞·ª£ng x·∫•u)<br>
                    <em class="direction-note">L∆∞u √Ω: T·ªïng s·ªë b·∫≠c n√™n l√† s·ªë l·∫ª (17, 21, 25) ƒë·ªÉ mang t√≠nh d∆∞∆°ng, t·ªët cho phong th·ªßy.</em>
            
                    <h4>üìç V·ªã tr√≠ ƒë·∫∑t c·∫ßu thang:</h4>
                    <strong>T·ªët nh·∫•t:</strong> C·∫ßu thang n√™n ·ªü h∆∞·ªõng <span class="highlight">${qd.dirs.bad[0]}</span> ho·∫∑c <span class="highlight">${qd.dirs.bad[1]}</span> ƒë·ªÉ "d·∫´n" hung kh√≠ ƒëi<br>
                    <strong>C√≥ th·ªÉ ch·∫•p nh·∫≠n:</strong> ƒê·∫∑t ·ªü g√≥c c·ªßa nh√†, kh√¥ng ·ªü gi·ªØa<br>
                    <strong>Tr√°nh:</strong> KH√îNG ƒë·∫∑t c·∫ßu thang ·ªü h∆∞·ªõng <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) - s·∫Ω r√≤ r·ªâ t√†i l·ªôc
            
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t m·ªôt ƒë√¥i k·ª≥ l√¢n ho·∫∑c t∆∞·ª£ng r·ªìng ·ªü ch√¢n c·∫ßu thang h∆∞·ªõng <span class="highlight">${qd.dirs.bad[0]}</span> (Tuy·ªát M·ªánh) ƒë·ªÉ tr·∫•n √°p hung kh√≠.<br>
                    - Treo g∆∞∆°ng b√°t qu√°i nh·ªè ·ªü ƒë·∫ßu c·∫ßu thang h∆∞·ªõng <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã) ƒë·ªÉ b·∫£o v·ªá nƒÉng l∆∞·ª£ng t√≠ch c·ª±c.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
            
                    <h4>üîÑ H√¨nh d√°ng & ki·ªÉu c·∫ßu thang:</h4>
                    <strong>T·ªët nh·∫•t:</strong> C·∫ßu thang h√¨nh xo·∫Øn ·ªëc ho·∫∑c h√¨nh ch·ªØ L<br>
                    <strong>C√≥ th·ªÉ ch·∫•p nh·∫≠n:</strong> C·∫ßu thang th·∫≥ng (n·∫øu kh√¥ng ·ªü gi·ªØa nh√†)<br>
                    <strong>Tr√°nh:</strong> <br>
                    ‚Ä¢ C·∫ßu thang l·ªách l·∫°c, b·∫≠c cao th·∫•p kh√¥ng ƒë·ªÅu<br>
                    ‚Ä¢ C·∫ßu thang qu√° d·ªëc ho·∫∑c qu√° n√¥ng<br>
                    ‚Ä¢ C·∫ßu thang ƒë·ªëi di·ªán tr·ª±c ti·∫øp v·ªõi c·ª≠a ch√≠nh<br>
                    ‚Ä¢ C·∫ßu thang ·ªü d∆∞·ªõi d·∫ßm ho·∫∑c trong g√≥c t·ªëi
            
                    <h4>üé® M√†u s·∫Øc c·∫ßu thang:</h4>
                    <strong>N√™n ch·ªçn:</strong> M√†u s√°ng, ·∫•m √°p (tr·∫Øng, kem, n√¢u nh·∫°t, x√°m nh·∫°t)<br>
                    <strong>Ch·∫•t li·ªáu:</strong> G·ªó t·ª± nhi√™n, ƒë√°, xi mƒÉng - tr√°nh k√≠nh trong su·ªët<br>
                    <strong>Tr√°nh:</strong> M√†u ƒëen, ƒë·ªè qu√° ƒë·∫≠m, ho·∫∑c k√≠nh trong su·ªët (kh√≠ r√≤ r·ªâ)
            
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>KH√îNG ƒë·∫∑t c·∫ßu thang ·ªü gi·ªØa nh√† (r·∫•t x·∫•u)</li>
                        <li>KH√îNG ƒë·∫∑t b√†n th·ªù d∆∞·ªõi g·∫ßm c·∫ßu thang</li>
                        <li>C·∫ßu thang ƒë·ªëi di·ªán c·ª≠a ch√≠nh = t√†i l·ªôc r√≤ r·ªâ</li>
                        <li>Lu√¥n gi·ªØ c·∫ßu thang s·∫°ch s·∫Ω, kh√¥ng b·ª•i b·∫∑m</li>
                        <li>S·ªë b·∫≠c c·∫ßu thang n√™n l√† s·ªë l·∫ª v√† r∆°i v√†o cung Sinh ho·∫∑c L√£o</li>
                    </ul>
                </div>
            `));

            // Section Ph√≤ng Kh√°ch
            fragment.appendChild(renderSection('üõãÔ∏è Phong Th·ªßy Ph√≤ng Kh√°ch', `
                <div class="info-box"><strong>üéØ H∆∞·ªõng T·ªêT NH·∫§T:</strong> <span class="highlight">${qd.dirs.good[0]} (Sinh Kh√≠)</span> - thu h√∫t t√†i l·ªôc v√† qu√Ω nh√¢n</div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·ª≠a Ph√≤ng Kh√°ch (Theo L·ªó Ban 52.2cm - D∆∞∆°ng Tr·∫°ch):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">78.3cm</span> - T√†i v·∫≠n<br>
                    ‚Ä¢ <span class="highlight">104.4cm</span> - Sinh kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">208.8cm</span> - Sinh kh√≠<br>
                    ‚Ä¢ <span class="highlight">234.9cm</span> - Ph√°t l·ªôc<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">104.4cm √ó 208.8cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ph√≤ng kh√°ch:</h4>
                    <strong>T·ªët nh·∫•t:</strong> Ph√≤ng kh√°ch ·ªü ph√≠a <span class="highlight">${qd.dirs.good[0]}</span> c·ªßa nh√† (Sinh Kh√≠ - v∆∞·ª£ng t√†i v·∫≠n, qu√Ω nh√¢n)<br>
                    <strong>L·ª±a ch·ªçn 2:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y - tho√°ng ƒë√£ng, s√°ng s·ªßa)<br>
                    <strong>L·ª±a ch·ªçn 3:</strong> ƒê·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã - b√¨nh an, ·ªïn ƒë·ªãnh)
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t b·ªÉ c√° nh·ªè ho·∫∑c th·∫°ch anh v√†ng ·ªü g√≥c <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) ƒë·ªÉ thu h√∫t t√†i l·ªôc.<br>
                    - ƒê·∫∑t t∆∞·ª£ng ph·∫≠t Di L·∫∑c ho·∫∑c c√¢y ph√°t t√†i ·ªü g√≥c <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) ƒë·ªÉ mang l·∫°i s·ª©c kh·ªèe v√† ni·ªÅm vui.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>üõãÔ∏è H∆∞·ªõng b√†n gh·∫ø ph√≤ng kh√°ch:</h4>
                    <strong>V·ªã tr√≠ gh·∫ø ch·ªß:</strong> N√™n h∆∞·ªõng m·∫∑t v·ªÅ <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) ho·∫∑c <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y)<br>
                    <strong>Nguy√™n t·∫Øc:</strong> Ng∆∞·ªùi ng·ªìi n√™n c√≥ t∆∞·ªùng v·ªØng ch·∫Øc ·ªü ph√≠a sau l∆∞ng, tr√°nh ng·ªìi quay l∆∞ng v·ªÅ c·ª≠a<br>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Ph√≤ng kh√°ch ph·∫£i r·ªông r√£i, s√°ng s·ªßa</li>
                        <li>KH√îNG ƒë·ªÉ g∆∞∆°ng soi ƒë·ªëi di·ªán c·ª≠a ch√≠nh</li>
                        <li>Lu√¥n gi·ªØ ph√≤ng kh√°ch s·∫°ch s·∫Ω, g·ªçn g√†ng</li>
                    </ul>
                </div>
            `));

            // Section Ph√≤ng Ng·ªß
            fragment.appendChild(renderSection('üõèÔ∏è Phong Th·ªßy Ph√≤ng Ng·ªß', `
                <div class="info-box"><strong>üéØ H∆∞·ªõng T·ªêT NH·∫§T:</strong> <span class="highlight">${qd.dirs.good[0]} (Sinh Kh√≠)</span> ho·∫∑c <span class="highlight">${qd.dirs.good[1]} (Thi√™n Y)</span></div>
                <div class="detail-box">
                    <h4>üìè K√≠ch Th∆∞·ªõc C·ª≠a Ph√≤ng Ng·ªß (Theo L·ªó Ban 52.2cm - D∆∞∆°ng Tr·∫°ch):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">78.3cm</span> - T√†i v·∫≠n<br>
                    ‚Ä¢ <span class="highlight">104.4cm</span> - Sinh kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">208.8cm</span> - Sinh kh√≠<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">104.4cm √ó 208.8cm</span>
                    
                    <h4>üìè K√≠ch Th∆∞·ªõc Gi∆∞·ªùng Ng·ªß (Theo L·ªó Ban 42.9cm):</h4>
                    <strong>Chi·ªÅu r·ªông (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">128.7cm</span> - T√†i l·ªôc<br>
                    ‚Ä¢ <span class="highlight">171.6cm</span> - V∆∞·ª£ng kh√≠ (t·ªët nh·∫•t)<br>
                    <strong>Chi·ªÅu d√†i (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">193cm</span> - ƒê·∫°i c√°t<br>
                    <strong>Chi·ªÅu cao (MAY):</strong><br>
                    ‚Ä¢ <span class="highlight">85.8cm</span> - T√†i v∆∞·ª£ng<br>
                    <strong>‚ú® K√≠ch th∆∞·ªõc T·ªêT NH·∫§T:</strong> <span style="background: #e8f5e9; padding: 5px 10px; border-radius: 5px; font-weight: bold;">171.6cm √ó 193cm √ó 85.8cm</span>
                    
                    <h4>üìç V·ªã tr√≠ ƒë·∫∑t ph√≤ng ng·ªß:</h4>
                    <strong>H∆∞·ªõng ∆∞u ti√™n 1:</strong> Ph√≤ng ng·ªß ƒë·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[0]}</span> c·ªßa nh√† (Sinh Kh√≠ - t·ªët cho t√†i l·ªôc, con c√°i)<br>
                    <strong>H∆∞·ªõng ∆∞u ti√™n 2:</strong> Ph√≤ng ng·ªß ƒë·∫∑t ·ªü ph√≠a <span class="highlight">${qd.dirs.good[1]}</span> c·ªßa nh√† (Thi√™n Y - t·ªët cho s·ª©c kh·ªèe)<br>
                    <strong>H∆∞·ªõng thay th·∫ø:</strong> C√≥ th·ªÉ ch·ªçn <span class="highlight">${qd.dirs.good[2]}</span> (Di√™n Ni√™n - t·ªët cho v·ª£ ch·ªìng)
                    
                    <h4>ü™¥ V·∫≠t ph·∫©m phong th·ªßy:</h4>
                    <strong>ƒê·ªÅ xu·∫•t:</strong> 
                    - ƒê·∫∑t th·∫°ch anh h·ªìng ho·∫∑c tinh th·ªÉ th·∫°ch anh t√≠m ·ªü g√≥c <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) g·∫ßn ƒë·∫ßu gi∆∞·ªùng ƒë·ªÉ tƒÉng s·ª©c kh·ªèe.<br>
                    - ƒê·∫∑t ƒë√¥i chim uy√™n ∆∞∆°ng ho·∫∑c t∆∞·ª£ng t√¨nh y√™u ·ªü g√≥c <span class="highlight">${qd.dirs.good[2]}</span> (Di√™n Ni√™n) ƒë·ªÉ h√≤a thu·∫≠n gia ƒë·∫°o.<br>
                    <em class="direction-note">Ch·ªçn v·∫≠t ph·∫©m theo m·ªánh ${m} (m√†u s·∫Øc: ${md.colors}) ƒë·ªÉ tƒÉng hi·ªáu qu·∫£.</em>
                    
                    <h4>üõå H∆∞·ªõng ƒë·∫ßu gi∆∞·ªùng n·∫±m:</h4>
                    <strong>T·ªët nh·∫•t:</strong> ƒê·∫ßu gi∆∞·ªùng h∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠)<br>
                    <strong>L·ª±a ch·ªçn 2:</strong> ƒê·∫ßu gi∆∞·ªùng h∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y)<br>
                    <strong>L·ª±a ch·ªçn 3:</strong> ƒê·∫ßu gi∆∞·ªùng h∆∞·ªõng v·ªÅ <span class="highlight">${qd.dirs.good[2]}</span> (Di√™n Ni√™n)<br>
                    <em class="direction-note">L∆∞u √Ω: "H∆∞·ªõng ƒë·∫ßu gi∆∞·ªùng" l√† h∆∞·ªõng ƒë·ªânh ƒë·∫ßu b·∫°n h∆∞·ªõng v·ªÅ khi n·∫±m tr√™n gi∆∞·ªùng</em>
                    
                    <h4>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h4>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>Kh√¥ng ƒë·∫∑t g∆∞∆°ng soi tr·ª±c di·ªán gi∆∞·ªùng</li>
                        <li>Tr√°nh d·∫ßm ƒë√® tr·ª±c ti·∫øp l√™n ƒë·∫ßu gi∆∞·ªùng</li>
                        <li>Gi∆∞·ªùng kh√¥ng n√™n chung t∆∞·ªùng v·ªõi toilet</li>
                        <li>ƒê·∫ßu gi∆∞·ªùng n√™n t·ª±a v√†o t∆∞·ªùng v·ªØng ch·∫Øc</li>
                        <li>Tr√°nh c·ª≠a ph√≤ng ƒë·ªëi th·∫≥ng ch√¢n gi∆∞·ªùng</li>
                    </ul>
                </div>
            `));

            // Section V·∫≠t Ph·∫©m & M√†u S·∫Øc
            fragment.appendChild(renderSection('üé® V·∫≠t Ph·∫©m & M√†u S·∫Øc Phong Th·ªßy', `
                <div class="detail-box">
                    <h4>üé® M√†u s·∫Øc t∆∞∆°ng sinh:</h4>
                    <strong>${md.colors}</strong><br><em class="direction-note">D√πng c√°c m√†u n√†y cho s∆°n t∆∞·ªùng, n·ªôi th·∫•t, qu·∫ßn √°o</em>
                    
                    <h4>üè∫ V·∫≠t ph·∫©m n√™n ƒë·∫∑t:</h4>
                    <strong>${md.items}</strong><br><em class="direction-note">ƒê·∫∑t ·ªü h∆∞·ªõng t·ªët (${qd.dirs.good[0]}, ${qd.dirs.good[1]}) ƒë·ªÉ tƒÉng v·∫≠n</em>
                    
                    <h4>üå± C√¢y phong th·ªßy:</h4>
                    <strong>${md.plants}</strong><br><em class="direction-note">ƒê·∫∑t c√¢y ·ªü g√≥c ph√≤ng kh√°ch ho·∫∑c h∆∞·ªõng Sinh Kh√≠</em>
                    
                    <h4>üíé ƒê√° phong th·ªßy & V·ªã tr√≠ ƒë·∫∑t:</h4>
                    <strong>${md.stones}</strong><br>
                    <strong>üìç V·ªã tr√≠ ƒë·∫∑t ƒë√° th·∫°ch anh trong nh√† (theo qu·∫ª ${q} v√† tu·ªïi ${y}):</strong><br>
                    <ul style="margin-left: 20px;">
                        <li><strong>T√†i l·ªôc:</strong> ƒê·∫∑t c·ª•m th·∫°ch anh v√†ng ho·∫∑c citrine ·ªü <span class="highlight">${qd.dirs.good[0]}</span> (Sinh Kh√≠) c·ªßa ph√≤ng kh√°ch ho·∫∑c b√†n l√†m vi·ªác ƒë·ªÉ thu h√∫t t√†i v·∫≠n. N·∫øu c√≥ th·ªÉ, ƒë·∫∑t th√™m ·ªü g√≥c tr√°i c·ª≠a ch√≠nh (nh√¨n t·ª´ trong ra).</li>
                        <li><strong>S·ª©c kh·ªèe:</strong> ƒê·∫∑t th·∫°ch anh h·ªìng ho·∫∑c th·∫°ch anh t√≠m ·ªü <span class="highlight">${qd.dirs.good[1]}</span> (Thi√™n Y) g·∫ßn ƒë·∫ßu gi∆∞·ªùng ph√≤ng ng·ªß ho·∫∑c g√≥c ph√≤ng t·∫Øm ƒë·ªÉ tƒÉng c∆∞·ªùng nƒÉng l∆∞·ª£ng ch·ªØa l√†nh.</li>
                        <li><strong>H√¥n nh√¢n & Gia ƒë·∫°o:</strong> ƒê·∫∑t th·∫°ch anh t√≠m ho·∫∑c th·∫°ch anh tr·∫Øng ·ªü <span class="highlight">${qd.dirs.good[2]}</span> (Di√™n Ni√™n) trong ph√≤ng kh√°ch ho·∫∑c khu v·ª±c sinh ho·∫°t chung ƒë·ªÉ th√∫c ƒë·∫©y h√≤a thu·∫≠n.</li>
                        <li><strong>B√¨nh an & ·ªîn ƒë·ªãnh:</strong> ƒê·∫∑t th·∫°ch anh ƒëen ho·∫∑c obsidian ·ªü <span class="highlight">${qd.dirs.good[3]}</span> (Ph·ª•c V·ªã) g·∫ßn c·ª≠a s·ªï ho·∫∑c g√≥c h·ªçc t·∫≠p/l√†m vi·ªác ƒë·ªÉ b·∫£o v·ªá nƒÉng l∆∞·ª£ng t√≠ch c·ª±c.</li>
                    </ul>
                    <em style="color: #f44336;">‚ö†Ô∏è L∆∞u √Ω: Kh√¥ng ƒë·∫∑t th·∫°ch anh t·∫°i h∆∞·ªõng ${qd.dirs.bad[0]} (Tuy·ªát M·ªánh)</em>
                </div>
            `));

            // Section M·∫πo TƒÉng C∆∞·ªùng V·∫≠n May
            fragment.appendChild(renderSection('üí° M·∫πo TƒÉng C∆∞·ªùng V·∫≠n May', `
                <div class="detail-box">
                    <ul style="margin-left: 20px;">
                        <li>‚ú® Th·∫Øp ƒë√®n ·ªü h∆∞·ªõng <strong>Sinh Kh√≠</strong> (${qd.dirs.good[0]}) ƒë·ªÉ tƒÉng t√†i v·∫≠n</li>
                        <li>üõèÔ∏è ƒê·∫∑t gi∆∞·ªùng ·ªü h∆∞·ªõng <strong>Thi√™n Y</strong> (${qd.dirs.good[1]}) n·∫øu ·ªëm y·∫øu</li>
                        <li>üíë H∆∞·ªõng <strong>Di√™n Ni√™n</strong> (${qd.dirs.good[2]}) t·ªët cho v·ª£ ch·ªìng h√≤a thu·∫≠n</li>
                        <li>üåø ƒê·∫∑t c√¢y xanh, b·ªÉ c√° ·ªü h∆∞·ªõng t·ªët</li>
                        <li>üßπ Lu√¥n gi·ªØ nh√† c·ª≠a s·∫°ch s·∫Ω, tho√°ng ƒë√£ng</li>
                        <li>üóëÔ∏è V·ª©t b·ªè ƒë·ªì c≈©, h∆∞ h·ªèng th∆∞·ªùng xuy√™n</li>
                        <li>üö™ C·ª≠a ch√≠nh ƒë·∫∑t ·ªü h∆∞·ªõng <span class="highlight">${qd.dirs.good[0]}</span> ho·∫∑c <span class="highlight">${qd.dirs.good[1]}</span> ƒë·ªÉ ƒë√≥n kh√≠ t·ªët</li>
                    </ul>
                </div>
            `));

            const results = document.getElementById('results');
            results.innerHTML = '';
            results.appendChild(fragment);
            results.classList.add('show');
            results.scrollIntoView({behavior: 'smooth'});
        }
        // ========== X·ª¨ L√ù LA B√ÄN ƒêI·ªÜN T·ª¨ T∆Ø∆†NG T√ÅC ==========
        let currentCompassHeading = 0;
        let isCompassActive = false;
        let detectedDirection = '';
        let deviceOrientationHandler = null;
        
        function getDirectionFromDegree(degree) {
            const directions = [
                { name: 'B·∫Øc', min: 337.5, max: 22.5 },
                { name: 'ƒê√¥ng B·∫Øc', min: 22.5, max: 67.5 },
                { name: 'ƒê√¥ng', min: 67.5, max: 112.5 },
                { name: 'ƒê√¥ng Nam', min: 112.5, max: 157.5 },
                { name: 'Nam', min: 157.5, max: 202.5 },
                { name: 'T√¢y Nam', min: 202.5, max: 247.5 },
                { name: 'T√¢y', min: 247.5, max: 292.5 },
                { name: 'T√¢y B·∫Øc', min: 292.5, max: 337.5 }
            ];
            
            for (let dir of directions) {
                if (degree >= dir.min && degree < dir.max) {
                    return dir.name;
                }
            }
            return 'B·∫Øc';
        }
        
        function handleDeviceOrientation(event) {
            let heading = null;
            
            if (event.webkitCompassHeading !== undefined) {
                heading = event.webkitCompassHeading;
            } else if (event.alpha !== null) {
                heading = 360 - event.alpha;
            }
            
            if (heading !== null && isCompassActive) {
                currentCompassHeading = Math.round(heading);
                detectedDirection = getDirectionFromDegree(currentCompassHeading);
                
                const compassSVG = document.getElementById('interactiveCompassSVG');
                const needle = document.getElementById('interactiveCompassNeedle');
                const degreeLabel = document.getElementById('compassDegreeLabel');
                const degreeText = document.getElementById('needleDegreeText');
                const applyBtn = document.getElementById('applyDirectionBtn');
                
                // C·∫≠p nh·∫≠t text
                if (degreeText) degreeText.textContent = currentCompassHeading + '¬∞ - ' + detectedDirection;
                if (applyBtn) applyBtn.disabled = false;
                
                // KIM C·ªê ƒê·ªäNH (lu√¥n ch·ªâ l√™n = ƒë·∫ßu ƒëi·ªán tho·∫°i)
                if (needle) {
                    needle.style.transform = 'none';
                }
                
                // SVG XOAY NG∆Ø·ª¢C ƒë·ªÉ h∆∞·ªõng B·∫Øc th·ª±c t·∫ø n·∫±m ƒë√∫ng v·ªã tr√≠
                if (compassSVG) {
                    compassSVG.style.transformOrigin = 'center';
                    compassSVG.style.transform = `rotate(${-currentCompassHeading}deg)`;
                }
                
                // Label kh√¥ng xoay
                if (degreeLabel) {
                    degreeLabel.style.transform = 'none';
                }
            }
        }
        
        function stopCompass() {
            if (deviceOrientationHandler) {
                window.removeEventListener('deviceorientation', handleDeviceOrientation);
                deviceOrientationHandler = null;
            }
            
            isCompassActive = false;
            
            // ·∫®n kim la b√†n v√† label
            const needle = document.getElementById('interactiveCompassNeedle');
            const degreeLabel = document.getElementById('compassDegreeLabel');
            if (needle) needle.classList.remove('active');
            if (degreeLabel) degreeLabel.classList.remove('active');
            
            // Reset n√∫t
            const activateBtn = document.getElementById('activateCompassBtn');
            if (activateBtn) {
                activateBtn.textContent = 'üß≠ K√≠ch Ho·∫°t La B√†n';
                activateBtn.classList.remove('active');
                activateBtn.disabled = false;
            }
        }
        
        async function activateInteractiveCompass() {
            const errorMsg = document.getElementById('compassErrorMsg');
            const activateBtn = document.getElementById('activateCompassBtn');
            const needle = document.getElementById('interactiveCompassNeedle');
            const degreeLabel = document.getElementById('compassDegreeLabel');
            
            if (errorMsg) errorMsg.classList.add('hidden');
            
            try {
                if (typeof DeviceOrientationEvent !== 'undefined' && 
                    typeof DeviceOrientationEvent.requestPermission === 'function') {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    
                    if (permission === 'granted') {
                        deviceOrientationHandler = handleDeviceOrientation;
                        window.addEventListener('deviceorientation', deviceOrientationHandler);
                        
                        activateBtn.textContent = '‚è∏ ƒêang ƒêo...';
                        activateBtn.classList.add('active');
                        activateBtn.disabled = true;
                        isCompassActive = true;
                        
                        // Hi·ªán kim la b√†n v√† label
                        if (needle) needle.classList.add('active');
                        if (degreeLabel) degreeLabel.classList.add('active');
                    } else {
                        throw new Error('C·∫ßn c·∫•p quy·ªÅn truy c·∫≠p c·∫£m bi·∫øn ƒë·ªÉ s·ª≠ d·ª•ng la b√†n');
                    }
                } else if (window.DeviceOrientationEvent) {
                    deviceOrientationHandler = handleDeviceOrientation;
                    window.addEventListener('deviceorientation', deviceOrientationHandler);
                    
                    activateBtn.textContent = '‚è∏ ƒêang ƒêo...';
                    activateBtn.classList.add('active');
                    activateBtn.disabled = true;
                    isCompassActive = true;
                    
                    // Hi·ªán kim la b√†n v√† label
                    if (needle) needle.classList.add('active');
                    if (degreeLabel) degreeLabel.classList.add('active');
                } else {
                    throw new Error('Thi·∫øt b·ªã kh√¥ng h·ªó tr·ª£ c·∫£m bi·∫øn la b√†n');
                }
            } catch (error) {
                if (errorMsg) {
                    errorMsg.textContent = '‚ö†Ô∏è ' + error.message;
                    errorMsg.classList.remove('hidden');
                }
            }
        }
        
        function applyCompassDirection() {
            if (detectedDirection && currentCompassHeading !== null) {
                const doorDirSelect = document.getElementById('doorDir');
                doorDirSelect.value = detectedDirection;
                
                // L∆∞u ƒë·ªô ch√≠nh x√°c
                preciseDoorDegree = currentCompassHeading;
                
                // D·ª´ng ƒëo v√† ·∫©n kim
                stopCompass();
                
                // T·ª± ƒë·ªông t√≠nh l·∫°i
                calculateFengShui();
                
                // Th√¥ng b√°o
                alert('‚úì ƒê√£ √°p d·ª•ng h∆∞·ªõng: ' + detectedDirection + ' (' + currentCompassHeading + '¬∞)\n\nK·∫øt qu·∫£ phong th·ªßy ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!');
            }
        }
        
        // G√°n s·ª± ki·ªán sau khi t√≠nh to√°n phong th·ªßy
        const originalCalculate = calculateFengShui;
        calculateFengShui = function() {
            originalCalculate();
            
            setTimeout(() => {
                const activateBtn = document.getElementById('activateCompassBtn');
                const applyBtn = document.getElementById('applyDirectionBtn');
                
                if (activateBtn) {
                    const newActivateBtn = activateBtn.cloneNode(true);
                    activateBtn.parentNode.replaceChild(newActivateBtn, activateBtn);
                    newActivateBtn.addEventListener('click', activateInteractiveCompass);
                    
                    if (!window.DeviceOrientationEvent) {
                        const errorMsg = document.getElementById('compassErrorMsg');
                        if (errorMsg) {
                            errorMsg.textContent = '‚ö†Ô∏è Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ c·∫£m bi·∫øn la b√†n';
                            errorMsg.classList.remove('hidden');
                        }
                        newActivateBtn.disabled = true;
                    }
                }
                
                if (applyBtn) {
                    const newApplyBtn = applyBtn.cloneNode(true);
                    applyBtn.parentNode.replaceChild(newApplyBtn, applyBtn);
                    newApplyBtn.addEventListener('click', applyCompassDirection);
                }
            }, 100);
        };
        
        // Reset khi ch·ªçn h∆∞·ªõng th·ªß c√¥ng
        document.getElementById('doorDir').addEventListener('change', function() {
            preciseDoorDegree = null;
            stopCompass();
        });
            </script>
</body>
</html>
